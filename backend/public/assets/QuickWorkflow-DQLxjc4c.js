import{r as e,z as t,j as r}from"./react-vendor-CjBIKxub.js";import{d as o,B as i}from"./index-B8lGzrsF.js";import{S as n,X as a,L as s,a1 as l,aH as d,aF as c,ac as p,an as u,ad as g,a6 as x,e as m,l as h}from"./icons-LCohXPIS.js";import{n as f,q as b,t as y}from"./firebase-jkeEGTKz.js";import"./vendor-BjQYSgJ0.js";function S({agent:S,onClose:w,projects:v=[],onSaveToProject:j,onCreateProject:k,user:C,userCredits:z=0,setUserCredits:I,isAdmin:R=!1}){const[_,$]=e.useState(()=>{const e=C?.uid||localStorage.getItem("studio_user_id")||"guest";return localStorage.getItem(`studio_${e}_workflow_prompt_${S?.id}`)||""});e.useEffect(()=>{if(S?.id){const e=C?.uid||localStorage.getItem("studio_user_id")||"guest";localStorage.setItem(`studio_${e}_workflow_prompt_${S.id}`,_)}},[_,S?.id,C?.uid]);const[W,B]=e.useState("English"),[T,N]=e.useState("Modern Hip-Hop"),[P,G]=e.useState("Gemini 2.0 Flash"),[O,F]=e.useState(()=>{const e=C?.uid||localStorage.getItem("studio_user_id")||"guest",t=localStorage.getItem(`studio_${e}_workflow_output_${S?.id}`);try{return t?JSON.parse(t):null}catch(r){return null}});e.useEffect(()=>{if(S?.id&&O){const e=C?.uid||localStorage.getItem("studio_user_id")||"guest";localStorage.setItem(`studio_${e}_workflow_output_${S.id}`,JSON.stringify(O))}else if(S?.id){const e=C?.uid||localStorage.getItem("studio_user_id")||"guest";localStorage.removeItem(`studio_${e}_workflow_output_${S.id}`)}},[O,S?.id,C?.uid]);const[L,M]=e.useState(!1),[A,H]=e.useState(!1),[U,E]=e.useState(""),[V,D]=e.useState(!1),[J,Y]=e.useState(!1),{isListening:K,isSpeaking:q,toggleListening:Q,speak:X,stopSpeaking:Z,isSpeechSupported:ee}=function(r={}){const{language:o="en-US",voiceGender:i="female",voiceRegion:n="US",onResult:a=null,onError:s=null}=r,[l,d]=e.useState(!1),[c,p]=e.useState(!1),u=e.useRef(null),g="undefined"!=typeof window&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),x="undefined"!=typeof window&&"speechSynthesis"in window,m=e.useCallback(e=>{if(!g)return t.error("Voice input not supported. Try Chrome or Safari."),void s?.("Voice input not supported");u.current&&u.current.stop();const r=new(window.SpeechRecognition||window.webkitSpeechRecognition);r.lang=o,r.continuous=!1,r.interimResults=!0,r.maxAlternatives=1,r.onstart=()=>{d(!0),t.success("ðŸŽ¤ Listening...",{duration:1500,id:"voice-listening"})},r.onend=()=>{d(!1),u.current=null},r.onerror=e=>{d(!1),u.current=null,"not-allowed"===e.error?t.error("Microphone access denied. Please allow microphone access."):"no-speech"===e.error?t.error("No speech detected. Please try again."):t.error(`Voice error: ${e.error}`),s?.(e.error)},r.onresult=r=>{const o=r.results,i=o[o.length-1];if(i.isFinal){const r=i[0].transcript;e&&"function"==typeof e?e(r):a&&a(r),t.success("âœ“ Got it!",{duration:1e3,id:"voice-listening"})}},u.current=r;try{r.start()}catch(i){t.error("Failed to start voice input"),d(!1)}},[g,o,a,s]),h=e.useCallback(()=>{u.current&&(u.current.stop(),u.current=null),d(!1)},[]),f=e.useCallback(e=>{l?h():m(e)},[l,m,h]),b=e.useCallback((e,t={})=>{if(!x)return;if(!e||"string"!=typeof e||0===e.trim().length)return;window.speechSynthesis.cancel();const r=r=>{const a=new SpeechSynthesisUtterance(e),s=t.language||o.split("-")[0]||"en",l=r.filter(e=>e.lang.startsWith(s));let d=null;const c=t.region||n,u=t.gender||i;if("UK"===c||"GB"===c?d=l.find(e=>e.name.includes("UK")||e.name.includes("British")||e.lang.includes("GB")):"AU"===c?d=l.find(e=>e.name.includes("Australia")||e.lang.includes("AU")):"IN"===c&&(d=l.find(e=>e.name.includes("India")||e.lang.includes("IN"))),!d){const e="female"===u?["female","samantha","victoria","karen","moira","fiona"]:["male","alex","daniel","fred","tom"];d=l.find(t=>e.some(e=>t.name.toLowerCase().includes(e)))}!d&&l.length>0&&(d=l[0]),d&&(a.voice=d),a.lang=s,a.rate=t.rate||.95,a.pitch=t.pitch||("female"===u?1.05:.95),a.volume=t.volume||1,a.onstart=()=>p(!0),a.onend=()=>p(!1),a.onerror=e=>{p(!1)},window.speechSynthesis.speak(a)};let a=window.speechSynthesis.getVoices();if(a.length>0)r(a);else{const e=()=>{a=window.speechSynthesis.getVoices(),a.length>0&&(r(a),window.speechSynthesis.onvoiceschanged=null)};window.speechSynthesis.onvoiceschanged=e,setTimeout(()=>{c||(a=window.speechSynthesis.getVoices(),a.length>0&&r(a))},100)}},[x,o,i,n]),y=e.useCallback(()=>{x&&(window.speechSynthesis.cancel(),p(!1))},[x]),S=e.useCallback(e=>{c?y():b(e)},[c,b,y]);return{isListening:l,isSpeaking:c,isVoiceSupported:g,isSpeechSupported:x,startListening:m,stopListening:h,toggleListening:f,speak:b,stopSpeaking:y,toggleSpeaking:S}}({language:"en-US"}),te=S.examples?.slice(0,3)||[];return r.jsx("div",{className:"modal-overlay animate-fadeIn",onClick:w,style:{zIndex:10001},children:r.jsxs("div",{className:"modal-content quick-workflow-modal",onClick:e=>e.stopPropagation(),style:{maxWidth:"560px",width:"min(95vw, 560px)",maxHeight:"min(90vh, 850px)",height:"auto",overflow:"hidden",display:"flex",flexDirection:"column",margin:"auto",padding:0,boxShadow:"0 25px 60px rgba(0,0,0,0.6)",border:"1px solid rgba(255,255,255,0.12)",background:"#0f0f12"},children:[r.jsxs("div",{className:"modal-header",style:{borderBottom:"1px solid rgba(255,255,255,0.08)",padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",flexShrink:0,background:"rgba(255,255,255,0.02)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1,minWidth:0},children:[r.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`${S.color||"var(--color-purple)"}25`,display:"flex",alignItems:"center",justifyContent:"center",color:S.color||"var(--color-purple)",flexShrink:0},children:"function"==typeof S.icon?r.jsx(S.icon,{size:20}):r.jsx(n,{size:20})}),r.jsxs("div",{style:{minWidth:0},children:[r.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"700",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"white"},children:S.name}),r.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.75rem",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:S.role||S.category})]})]}),r.jsx("button",{className:"modal-close",onClick:w,style:{position:"relative",top:"auto",right:"auto",flexShrink:0,width:"32px",height:"32px",minWidth:"32px",background:"rgba(255,255,255,0.05)",borderRadius:"50%"},children:r.jsx(a,{size:20})})]}),r.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px"},children:[r.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",flexWrap:"wrap"},children:[r.jsxs("div",{style:{flex:1,minWidth:"100px"},children:[r.jsx("label",{style:{display:"block",fontSize:"0.7rem",color:"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.05em"},children:"Language"}),r.jsx("select",{value:W,onChange:e=>B(e.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",outline:"none",cursor:"pointer"},children:["English","Spanish","French","German","Japanese","Korean","Portuguese","Italian","Chinese"].map(e=>r.jsx("option",{value:e,style:{background:"#1a1a1a"},children:e},e))})]}),r.jsxs("div",{style:{flex:1,minWidth:"100px"},children:[r.jsx("label",{style:{display:"block",fontSize:"0.7rem",color:"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.05em"},children:"Style"}),r.jsx("select",{value:T,onChange:e=>N(e.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",outline:"none",cursor:"pointer"},children:["Modern Hip-Hop","90s Boom Bap","Trap","R&B / Soul","Pop","Rock","Electronic","Cinematic","Jazz","Lo-Fi"].map(e=>r.jsx("option",{value:e,style:{background:"#1a1a1a"},children:e},e))})]}),r.jsxs("div",{style:{flex:1,minWidth:"100px"},children:[r.jsx("label",{style:{display:"block",fontSize:"0.7rem",color:"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.05em"},children:"Model"}),r.jsx("select",{value:P,onChange:e=>G(e.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"white",fontSize:"0.8rem",outline:"none",cursor:"pointer"},children:["Gemini 2.0 Flash","Gemini 2.0 Pro (Exp)","Gemini 1.5 Flash","Gemini 1.5 Pro"].map(e=>r.jsx("option",{value:e,style:{background:"#1a1a1a"},children:e},e))})]})]}),te.length>0&&!O&&r.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[r.jsxs("button",{onClick:()=>Y(!J),style:{padding:"6px 12px",borderRadius:"10px",background:J?"rgba(139, 92, 246, 0.2)":"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:J?"#a855f7":"#94a3b8",fontSize:"0.75rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx(s,{size:14}),J?"Close Suggestions":"Inspire Me"]}),J&&te.map((e,t)=>r.jsx("button",{onClick:()=>{$(e),Y(!1)},style:{padding:"6px 14px",fontSize:"0.75rem",background:"rgba(139, 92, 246, 0.12)",border:"1px solid rgba(139, 92, 246, 0.25)",borderRadius:"20px",color:"#e2e8f0",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="rgba(139, 92, 246, 0.2)",onMouseOut:e=>e.target.style.background="rgba(139, 92, 246, 0.12)",children:e.length>35?e.substring(0,35)+"...":e},t))]}),r.jsxs("div",{style:{position:"relative",marginBottom:"20px"},children:[r.jsx("textarea",{value:_,onChange:e=>$(e.target.value),placeholder:S.example||`Describe what you want ${S.name} to create...`,style:{width:"100%",minHeight:"120px",padding:"16px",paddingRight:"50px",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",color:"white",fontSize:"1rem",resize:"vertical",fontFamily:"inherit",lineHeight:"1.5",outline:"none",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.2)"},autoFocus:!0}),r.jsx("button",{onClick:()=>{Q(e=>{$(t=>t+(t?" ":"")+e)})},style:{position:"absolute",right:"12px",top:"12px",background:K?"#a855f7":"rgba(255,255,255,0.05)",border:"none",color:K?"white":"var(--text-secondary)",cursor:"pointer",padding:"10px",borderRadius:"10px",transition:"all 0.2s"},title:"Voice input",children:r.jsx(l,{size:20,className:K?"animate-pulse":""})})]}),r.jsx("button",{onClick:async()=>{if(_.trim())if(C&&!R&&z<=0)t.error("Out of credits! Please purchase more in your Studio.");else{M(!0),F(null);try{if(C&&!R)try{const e=f(o,"users",C.uid);await b(e,{credits:y(-1)}),I&&I(e=>Math.max(0,e-1))}catch(e){}const r=await(async()=>{if(C)try{return await C.getIdToken()}catch{}return null})(),n={"Content-Type":"application/json"};r&&(n.Authorization=`Bearer ${r}`);const a={"Gemini 2.0 Flash":"gemini-2.0-flash","Gemini 2.0 Pro (Exp)":"gemini-2.0-flash-exp","Gemini 1.5 Flash":"gemini-1.5-flash","Gemini 1.5 Pro":"gemini-1.5-pro"}[P]||"gemini-2.0-flash",s=await fetch(`${i}/api/generate`,{method:"POST",headers:n,body:JSON.stringify({prompt:`[Language: ${W}] [Style: ${T}] ${_}`,systemInstruction:S.systemPrompt||`You are ${S.name}, a ${S.role||S.description}. ${S.howToUse||""} Please respond in ${W}.`,model:a})}),l=await s.json();if(l.output){if(F(l.output),t.success("Generated!"),ee){const e=l.output.substring(0,200)+(l.output.length>200?"...":"");X(e)}}else l.error&&t.error(l.error)}catch(e){t.error("Failed to generate. Check connection.")}finally{M(!1)}}else t.error("Please enter a prompt")},disabled:L||!_.trim(),className:"cta-button-premium",style:{width:"100%",justifyContent:"center",padding:"16px",fontSize:"1rem",borderRadius:"12px",background:L||!_.trim()?"rgba(139, 92, 246, 0.3)":"var(--color-purple)",boxShadow:L||!_.trim()?"none":"0 10px 20px rgba(139, 92, 246, 0.3)"},children:L?r.jsxs(r.Fragment,{children:[r.jsx(d,{size:18,className:"spin"}),"Generating..."]}):r.jsxs(r.Fragment,{children:[r.jsx(n,{size:18}),S.getStarted||"Generate"]})}),O&&r.jsxs("div",{style:{marginTop:"24px"},className:"animate-fadeInUp",children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Output"}),r.jsxs("div",{style:{display:"flex",gap:"12px"},children:[ee&&r.jsxs("button",{onClick:()=>{q?Z():O&&X(O)},style:{background:q?"rgba(168, 85, 247, 0.2)":"none",border:"none",color:q?"var(--color-purple)":"var(--text-secondary)",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.8rem",padding:"4px 8px",borderRadius:"6px"},title:q?"Stop speaking":"Read aloud",children:[q?r.jsx(c,{size:14}):r.jsx(p,{size:14}),q?"Stop":"Listen"]}),r.jsxs("button",{onClick:()=>{O&&(navigator.clipboard.writeText(O),D(!0),t.success("Copied to clipboard"),setTimeout(()=>D(!1),2e3))},style:{background:"none",border:"none",color:V?"var(--color-green)":"var(--text-secondary)",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.8rem"},children:[V?r.jsx(u,{size:14}):r.jsx(g,{size:14}),V?"Copied!":"Copy"]})]})]}),r.jsx("div",{style:{background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"16px",maxHeight:"200px",overflowY:"auto",whiteSpace:"pre-wrap",fontSize:"0.95rem",lineHeight:"1.6",color:"#e2e8f0",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.3)"},children:O}),r.jsx("div",{style:{marginTop:"16px"},children:A?r.jsxs("div",{className:"save-options animate-fadeIn",style:{background:"rgba(255,255,255,0.03)",borderRadius:"16px",padding:"20px",border:"1px solid rgba(255,255,255,0.1)"},children:[r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.05em"},children:[r.jsx(m,{size:14,style:{verticalAlign:"middle",marginRight:"6px",color:"var(--color-purple)"}}),"Create new project"]}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx("input",{type:"text",value:U,onChange:e=>E(e.target.value),placeholder:"My Awesome Track...",style:{flex:1,padding:"12px 14px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",color:"white",fontSize:"0.95rem",outline:"none"}}),r.jsx("button",{onClick:()=>{if(!U.trim())return void t.error("Please enter a project name");const e={id:Date.now(),type:"text",agent:S.id,agentName:S.name,prompt:_,output:O,createdAt:(new Date).toISOString()};k(U.trim(),e),H(!1),E(""),t.success(`Created project "${U}"`)},disabled:!U.trim(),className:"cta-button-premium",style:{padding:"0 20px",borderRadius:"10px"},children:"Create"})]})]}),v.length>0&&r.jsxs("div",{children:[r.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.05em"},children:"Add to existing project"}),r.jsx("div",{style:{maxHeight:"180px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"8px"},children:v.slice(0,5).map(e=>r.jsxs("button",{onClick:()=>(e=>{const r={id:Date.now(),type:"text",agent:S.id,agentName:S.name,prompt:_,output:O,createdAt:(new Date).toISOString()};j(e.id,r),H(!1),t.success(`Saved to ${e.name}`)})(e),style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"10px",color:"white",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.95rem",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="rgba(255,255,255,0.1)",onMouseOut:e=>e.target.style.background="rgba(255,255,255,0.05)",children:[r.jsx("span",{style:{fontWeight:"500"},children:e.name}),r.jsx(h,{size:18,style:{color:"var(--text-secondary)"}})]},e.id))})]}),r.jsx("button",{onClick:()=>H(!1),style:{marginTop:"16px",background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"0.85rem",width:"100%",textAlign:"center",fontWeight:"500"},children:"Cancel"})]}):r.jsxs("button",{onClick:()=>H(!0),style:{width:"100%",padding:"14px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",color:"white",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",fontSize:"0.95rem",fontWeight:"600",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="rgba(255,255,255,0.08)",onMouseOut:e=>e.target.style.background="rgba(255,255,255,0.05)",children:[r.jsx(x,{size:18}),"Save to Project"]})})]})]})]})})}export{S as default};
