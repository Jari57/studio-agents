import{o as e}from"./vendor-BjQYSgJ0.js";var t={};const n=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++s)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,o=i?e[r+1]:0,a=r+2<e.length,c=a?e[r+2]:0,h=t>>2,u=(3&t)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),s.push(n[h],n[u],n[l],n[d])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const r=e[n++];if(r<128)t[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[n++];t[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(i>>10)),t[s++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const a=i<e.length?n[e.charAt(i)]:64;++i;const c=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==a||null==c)throw new r;const h=t<<2|o>>4;if(s.push(h),64!==a){const e=o<<4&240|a>>2;if(s.push(e),64!==c){const e=a<<6&192|c;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(e){return function(e){const t=n(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return s.decodeString(e,!0)}catch(t){}return null};const a=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return a()||(()=>{if("undefined"==typeof process)return;const e=t.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return}},h=e=>c()?.emulatorHosts?.[e],u=()=>c()?.config,l=e=>c()?.[`_${e}`];class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function f(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function p(e){return(await fetch(e,{credentials:"include"})).ok}const m={};let g=!1;function y(e,t){if("undefined"==typeof window||"undefined"==typeof document||!f(window.location.host)||m[e]===t||m[e]||g)return;function n(e){return`__firebase__banner__${e}`}m[e]=t;const s="__firebase__banner",r=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(m))m[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{g=!0,function(){const e=document.getElementById(s);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(s),t=n("text"),o=document.getElementById(t)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),h=n("preprendIcon"),u=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(c,a);const n=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,h),t.append(u,o,c,n),document.body.appendChild(t)}r?(o.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function w(){return!function(){const e=c()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class _ extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(T,(e,n)=>{const s=t[n];return null!=s?String(s):`<${n}?>`})}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new _(s,o,n)}}const T=/\{\$([^}]+)}/g;function I(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const r of n){if(!s.includes(r))return!1;const n=e[r],i=t[r];if(b(n)&&b(i)){if(!I(n,i))return!1}else if(n!==i)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function b(e){return null!==e&&"object"==typeof e}function S(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function C(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,s]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}}),t}function A(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class k{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");s=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===s.next&&(s.next=N),void 0===s.error&&(s.error=N),void 0===s.complete&&(s.complete=N);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(e){}}),this.observers.push(s),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function N(){}function R(e){return e&&e._delegate?e._delegate:e}class D{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const O="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new d;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(n)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:O})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:s});n.resolve(e)}catch(t){}}}}clearInstance(e=O){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=O){return this.instances.has(e)}getOptions(e=O){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&i.resolve(s)}return s}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&e(r,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===O?void 0:s),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var s;return n||null}normalizeInstanceIdentifier(e=O){return this.component?this.component.multipleInstances?e:O:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var M,x;(x=M||(M={}))[x.DEBUG=0]="DEBUG",x[x.VERBOSE=1]="VERBOSE",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT";const V={debug:M.DEBUG,verbose:M.VERBOSE,info:M.INFO,warn:M.WARN,error:M.ERROR,silent:M.SILENT},U=M.INFO,F={[M.DEBUG]:"log",[M.VERBOSE]:"log",[M.INFO]:"info",[M.WARN]:"warn",[M.ERROR]:"error"},j=(e,t,...n)=>{if(t<e.logLevel)return;(new Date).toISOString();if(!F[t])throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class B{constructor(e){this.name=e,this._logLevel=U,this._logHandler=j,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in M))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?V[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,M.DEBUG,...e),this._logHandler(this,M.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,M.VERBOSE,...e),this._logHandler(this,M.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,M.INFO,...e),this._logHandler(this,M.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,M.WARN,...e),this._logHandler(this,M.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,M.ERROR,...e),this._logHandler(this,M.ERROR,...e)}}class q{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const z="@firebase/app",$="0.14.6",H=new B("@firebase/app"),K="@firebase/app-compat",G="@firebase/analytics-compat",W="@firebase/analytics",Q="@firebase/app-check-compat",X="@firebase/app-check",J="@firebase/auth",Y="@firebase/auth-compat",Z="@firebase/database",ee="@firebase/data-connect",te="@firebase/database-compat",ne="@firebase/functions",se="@firebase/functions-compat",re="@firebase/installations",ie="@firebase/installations-compat",oe="@firebase/messaging",ae="@firebase/messaging-compat",ce="@firebase/performance",he="@firebase/performance-compat",ue="@firebase/remote-config",le="@firebase/remote-config-compat",de="@firebase/storage",fe="@firebase/storage-compat",pe="@firebase/firestore",me="@firebase/ai",ge="@firebase/firestore-compat",ye="firebase",ve="[DEFAULT]",we={[z]:"fire-core",[K]:"fire-core-compat",[W]:"fire-analytics",[G]:"fire-analytics-compat",[X]:"fire-app-check",[Q]:"fire-app-check-compat",[J]:"fire-auth",[Y]:"fire-auth-compat",[Z]:"fire-rtdb",[ee]:"fire-data-connect",[te]:"fire-rtdb-compat",[ne]:"fire-fn",[se]:"fire-fn-compat",[re]:"fire-iid",[ie]:"fire-iid-compat",[oe]:"fire-fcm",[ae]:"fire-fcm-compat",[ce]:"fire-perf",[he]:"fire-perf-compat",[ue]:"fire-rc",[le]:"fire-rc-compat",[de]:"fire-gcs",[fe]:"fire-gcs-compat",[pe]:"fire-fst",[ge]:"fire-fst-compat",[me]:"fire-vertex","fire-js":"fire-js",[ye]:"fire-js-all"},_e=new Map,Ee=new Map,Te=new Map;function Ie(e,t){try{e.container.addComponent(t)}catch(n){H.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function be(e){const t=e.name;if(Te.has(t))return H.debug(`There were multiple attempts to register component ${t}.`),!1;Te.set(t,e);for(const n of _e.values())Ie(n,e);for(const n of Ee.values())Ie(n,e);return!0}function Se(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ce(e){return null!=e&&void 0!==e.settings}const Ae=new E("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ke{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new D("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ae.create("app-deleted",{appName:this._name})}}const Ne="12.6.0";function Re(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const s={name:ve,automaticDataCollectionEnabled:!0,...t},r=s.name;if("string"!=typeof r||!r)throw Ae.create("bad-app-name",{appName:String(r)});if(n||(n=u()),!n)throw Ae.create("no-options");const i=_e.get(r);if(i){if(I(n,i.options)&&I(s,i.config))return i;throw Ae.create("duplicate-app",{appName:r})}const o=new L(r);for(const c of Te.values())o.addComponent(c);const a=new ke(n,s,o);return _e.set(r,a),a}function De(e=ve){const t=_e.get(e);if(!t&&e===ve&&u())return Re();if(!t)throw Ae.create("no-app",{appName:e});return t}function Oe(e,t,n){let s=we[e]??e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),i=t.match(/\s|\//);if(r||i){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void H.warn(e.join(" "))}be(new D(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const Pe="firebase-heartbeat-store";let Le=null;function Me(){return Le||(Le=e("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Pe)}catch(n){}}}).catch(e=>{throw Ae.create("idb-open",{originalErrorMessage:e.message})})),Le}async function xe(e,t){try{const n=(await Me()).transaction(Pe,"readwrite"),s=n.objectStore(Pe);await s.put(t,Ve(e)),await n.done}catch(n){if(n instanceof _)H.warn(n.message);else{const e=Ae.create("idb-set",{originalErrorMessage:n?.message});H.warn(e.message)}}}function Ve(e){return`${e.name}!${e.options.appId}`}class Ue{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new je(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Fe();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let s=1;s<e.length;s++)e[s].date<n&&(n=e[s].date,t=s);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){H.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=Fe(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let s=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),Be(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Be(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return H.warn(e),""}}}function Fe(){return(new Date).toISOString().substring(0,10)}class je{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Me()).transaction(Pe),n=await t.objectStore(Pe).get(Ve(e));return await t.done,n}catch(t){if(t instanceof _)H.warn(t.message);else{const e=Ae.create("idb-get",{originalErrorMessage:t?.message});H.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return xe(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return xe(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Be(e){return i(JSON.stringify({version:2,heartbeats:e})).length}var qe;qe="",be(new D("platform-logger",e=>new q(e),"PRIVATE")),be(new D("heartbeat",e=>new Ue(e),"PRIVATE")),Oe(z,$,qe),Oe(z,$,"esm2020"),Oe("fire-js","");function ze(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}Oe("firebase","12.6.0","app");const $e=ze,He=new E("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ke=new B("@firebase/auth");function Ge(e,...t){Ke.logLevel<=M.ERROR&&Ke.error(`Auth (${Ne}): ${e}`,...t)}function We(e,...t){throw Ye(e,...t)}function Qe(e,...t){return Ye(e,...t)}function Xe(e,t,n){const s={...$e(),[t]:n};return new E("auth","Firebase",s).create(t,{appName:e.name})}function Je(e){return Xe(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ye(e,...t){if("string"!=typeof e){const n=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(n,...s)}return He.create(e,...t)}function Ze(e,t,...n){if(!e)throw Ye(t,...n)}function et(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Ge(t),new Error(t)}function tt(e,t){e||et(t)}function nt(){return"undefined"!=typeof self&&self.location?.href||""}function st(){return"undefined"!=typeof self&&self.location?.protocol||null}function rt(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==st()&&"https:"!==st()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}class it{constructor(e,t){this.shortDelay=e,this.longDelay=t,tt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return rt()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ot(e,t){tt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class at{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void et("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void et("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void et("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ct={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ht=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ut=new it(3e4,6e4);function lt(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function dt(e,t,n,s,r={}){return ft(e,r,async()=>{let r={},i={};s&&("GET"===t?i=s:r={body:JSON.stringify(s)});const o=S({key:e.config.apiKey,...i}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c={method:t,headers:a,...r};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&f(e.emulatorConfig.host)&&(c.credentials="include"),at.fetch()(await mt(e,e.config.apiHost,n,o),c)})}async function ft(e,t,n){e._canInitEmulator=!1;const s={...ct,...t};try{const t=new yt(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw vt(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw vt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw vt(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw vt(e,"user-disabled",i);const a=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Xe(e,a,o);We(e,a)}}catch(r){if(r instanceof _)throw r;We(e,"network-request-failed",{message:String(r)})}}async function pt(e,t,n,s,r={}){const i=await dt(e,t,n,s,r);return"mfaPendingCredential"in i&&We(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function mt(e,t,n,s){const r=`${t}${n}?${s}`,i=e,o=i.config.emulator?ot(e.config,r):`${e.config.apiScheme}://${r}`;if(ht.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())){return i._getPersistence()._getFinalTarget(o).toString()}return o}function gt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class yt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Qe(this.auth,"network-request-failed")),ut.get())})}}function vt(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=Qe(e,t,s);return r.customData._tokenResponse=n,r}function wt(e){return void 0!==e&&void 0!==e.enterprise}class _t{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return gt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Et(e,t){return dt(e,"POST","/v1/accounts:lookup",t)}function Tt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function It(e,t=!1){return R(e).getIdToken(t)}function bt(e){return 1e3*Number(e)}function St(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return Ge("JWT malformed, contained fewer than 3 sections"),null;try{const e=o(n);return e?JSON.parse(e):(Ge("Failed to decode base64 JWT payload"),null)}catch(r){return Ge("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Ct(e){const t=St(e);return Ze(t,"internal-error"),Ze(void 0!==t.exp,"internal-error"),Ze(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function At(e,t,n=!1){if(n)return t;try{return await t}catch(s){throw s instanceof _&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(s)&&e.auth.currentUser===e&&await e.auth.signOut(),s}}class kt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class Nt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tt(this.lastLoginAt),this.creationTime=Tt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Rt(e){const t=e.auth,n=await e.getIdToken(),s=await At(e,Et(t,{idToken:n}));Ze(s?.users.length,t,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const i=r.providerUserInfo?.length?Dt(r.providerUserInfo):[],o=(a=e.providerData,c=i,[...a.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var a,c;const h=e.isAnonymous,u=!(e.email&&r.passwordHash||o?.length),l=!!h&&u,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Nt(r.createdAt,r.lastLoginAt),isAnonymous:l};Object.assign(e,d)}function Dt(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}class Ot{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ze(e.idToken,"internal-error"),Ze(void 0!==e.idToken,"internal-error"),Ze(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Ct(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ze(0!==e.length,"internal-error");const t=Ct(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:r}=await async function(e,t){const n=await ft(e,{},async()=>{const n=S({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=e.config,i=await mt(e,s,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&f(e.emulatorConfig.host)&&(a.credentials="include"),at.fetch()(i,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:r}=t,i=new Ot;return n&&(Ze("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),s&&(Ze("string"==typeof s,"internal-error",{appName:e}),i.accessToken=s),r&&(Ze("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ot,this.toJSON())}_performRefresh(){return et("not implemented")}}function Pt(e,t){Ze("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Lt{constructor({uid:e,auth:t,stsTokenManager:n,...s}){this.providerId="firebase",this.proactiveRefresh=new kt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Nt(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await At(this,this.stsTokenManager.getToken(this.auth,e));return Ze(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=R(e),s=await n.getIdToken(t),r=St(s);Ze(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i="object"==typeof r.firebase?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:Tt(bt(r.auth_time)),issuedAtTime:Tt(bt(r.iat)),expirationTime:Tt(bt(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=R(e);await Rt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Lt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Rt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ce(this.auth.app))return Promise.reject(Je(this.auth));const e=await this.getIdToken();return await At(this,async function(e,t){return dt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,s=t.email??void 0,r=t.phoneNumber??void 0,i=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,c=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:u,emailVerified:l,isAnonymous:d,providerData:f,stsTokenManager:p}=t;Ze(u&&p,e,"internal-error");const m=Ot.fromJSON(this.name,p);Ze("string"==typeof u,e,"internal-error"),Pt(n,e.name),Pt(s,e.name),Ze("boolean"==typeof l,e,"internal-error"),Ze("boolean"==typeof d,e,"internal-error"),Pt(r,e.name),Pt(i,e.name),Pt(o,e.name),Pt(a,e.name),Pt(c,e.name),Pt(h,e.name);const g=new Lt({uid:u,auth:e,email:s,emailVerified:l,displayName:n,isAnonymous:d,photoURL:i,phoneNumber:r,tenantId:o,stsTokenManager:m,createdAt:c,lastLoginAt:h});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const s=new Ot;s.updateFromServerResponse(t);const r=new Lt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await Rt(r),r}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];Ze(void 0!==s.localId,"internal-error");const r=void 0!==s.providerUserInfo?Dt(s.providerUserInfo):[],i=!(s.email&&s.passwordHash||r?.length),o=new Ot;o.updateFromIdToken(n);const a=new Lt({uid:s.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new Nt(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash||r?.length)};return Object.assign(a,c),a}}const Mt=new Map;function xt(e){tt(e instanceof Function,"Expected a class definition");let t=Mt.get(e);return t?(tt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Mt.set(e,t),t)}class Vt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Vt.type="NONE";const Ut=Vt;function Ft(e,t,n){return`firebase:${e}:${t}:${n}`}class jt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:r}=this.auth;this.fullUserKey=Ft(this.userKey,s.apiKey,r),this.fullPersistenceKey=Ft("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Et(this.auth,{idToken:e}).catch(()=>{});return t?Lt._fromGetAccountInfoResponse(this.auth,t,e):null}return Lt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new jt(xt(Ut),e,n);const s=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=s[0]||xt(Ut);const i=Ft(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(i);if(t){let n;if("string"==typeof t){const s=await Et(e,{idToken:t}).catch(()=>{});if(!s)break;n=await Lt._fromGetAccountInfoResponse(e,s,t)}else n=Lt._fromJSON(e,t);c!==r&&(o=n),r=c;break}}catch{}const a=s.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(i)}catch{}})),new jt(r,e,n)):new jt(r,e,n)}}function Bt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ht(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(qt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Gt(t))return"Blackberry";if(Wt(t))return"Webos";if(zt(t))return"Safari";if((t.includes("chrome/")||$t(t))&&!t.includes("edge/"))return"Chrome";if(Kt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function qt(e=v()){return/firefox\//i.test(e)}function zt(e=v()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function $t(e=v()){return/crios\//i.test(e)}function Ht(e=v()){return/iemobile/i.test(e)}function Kt(e=v()){return/android/i.test(e)}function Gt(e=v()){return/blackberry/i.test(e)}function Wt(e=v()){return/webos/i.test(e)}function Qt(e=v()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xt(){return function(){const e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Jt(e=v()){return Qt(e)||Kt(e)||Wt(e)||Gt(e)||/windows phone/i.test(e)||Ht(e)}function Yt(e,t=[]){let n;switch(e){case"Browser":n=Bt(v());break;case"Worker":n=`${Bt(v())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ne}/${s}`}class Zt{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,s)=>{try{n(e(t))}catch(r){s(r)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(s){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}class en{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class tn{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sn(this),this.idTokenSubscription=new sn(this),this.beforeStateQueue=new Zt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=He,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=xt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await jt.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Et(this,{idToken:e}),n=await Lt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ce(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,i=await this.tryRedirectSignIn(e);t&&t!==r||!i?.user||(n=i.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(r){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Rt(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ce(this.app))return Promise.reject(Je(this));const t=e?R(e):null;return t&&Ze(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ce(this.app)?Promise.reject(Je(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ce(this.app)?Promise.reject(Je(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xt(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return dt(e,"GET","/v2/passwordPolicy",lt(e,t))}(this),t=new en(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new E("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return dt(e,"POST","/v2/accounts:revokeToken",lt(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&xt(e)||this._popupRedirectResolver;Ze(t,this,"argument-error"),this.redirectPersistenceManager=await jt.create(this,[xt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ze(o,this,"internal-error"),o.then(()=>{i||r(this.currentUser)}),"function"==typeof t){const r=e.addObserver(t,n,s);return()=>{i=!0,r()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Yt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Ce(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){Ke.logLevel<=M.WARN&&Ke.warn(`Auth (${Ne}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function nn(e){return R(e)}class sn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new k(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return Ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let rn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function on(e){return rn.loadJS(e)}class an{constructor(){this.enterprise=new cn}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class cn{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const hn="NO_RECAPTCHA";class un{constructor(e){this.type="recaptcha-enterprise",this.auth=nn(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{(async function(e,t){return dt(e,"GET","/v2/recaptchaConfig",lt(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(s=>{if(void 0!==s.recaptchaKey){const n=new _t(s);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})}function s(t,n,s){const r=window.grecaptcha;wt(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(hn)})}):s(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new an).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&wt(window.grecaptcha))s(n,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=rn.recaptchaEnterpriseScript;0!==t.length&&(t+=n),on(t).then(()=>{s(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function ln(e,t,n,s=!1,r=!1){const i=new un(e);let o;if(r)o=hn;else try{o=await i.verify(n)}catch(c){o=await i.verify(n,!0)}const a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function dn(e,t,n,s,r){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await ln(e,t,n,"getOobCode"===n);return s(e,r)}return s(e,t).catch(async r=>{if("auth/missing-recaptcha-token"===r.code){const r=await ln(e,t,n,"getOobCode"===n);return s(e,r)}return Promise.reject(r)})}function fn(e,t,n){const s=nn(e);Ze(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const r=pn(t),{host:i,port:o}=function(e){const t=pn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const e=r[1];return{host:e,port:mn(s.substr(e.length+1))}}{const[e,t]=s.split(":");return{host:e,port:mn(t)}}}(t),a=null===o?"":`:${o}`,c={url:`${r}//${i}${a}/`},h=Object.freeze({host:i,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!s._canInitEmulator)return Ze(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),void Ze(I(c,s.config.emulator)&&I(h,s.emulatorConfig),s,"emulator-config-failed");s.config.emulator=c,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,f(i)?(p(`${r}//${i}${a}`),y("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info;"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function pn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function mn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class gn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return et("not implemented")}_getIdTokenResponse(e){return et("not implemented")}_linkToIdToken(e,t){return et("not implemented")}_getReauthenticationResolver(e){return et("not implemented")}}async function yn(e,t){return dt(e,"POST","/v1/accounts:signUp",t)}async function vn(e,t){return pt(e,"POST","/v1/accounts:signInWithPassword",lt(e,t))}async function wn(e,t){return async function(e,t){return dt(e,"POST","/v1/accounts:sendOobCode",lt(e,t))}(e,t)}class _n extends gn{constructor(e,t,n,s=null){super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new _n(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new _n(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return dn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",vn);case"emailLink":return async function(e,t){return pt(e,"POST","/v1/accounts:signInWithEmailLink",lt(e,t))}(e,{email:this._email,oobCode:this._password});default:We(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return dn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",yn);case"emailLink":return async function(e,t){return pt(e,"POST","/v1/accounts:signInWithEmailLink",lt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:We(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function En(e,t){return pt(e,"POST","/v1/accounts:signInWithIdp",lt(e,t))}class Tn extends gn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Tn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):We("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s,...r}=t;if(!n||!s)return null;const i=new Tn(n,s);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return En(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,En(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,En(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=S(t)}return e}}class In{constructor(e){const t=C(A(e)),n=t.apiKey??null,s=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);Ze(n&&s&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=C(A(e)).link,n=t?C(A(t)).deep_link_id:null,s=C(A(e)).deep_link_id;return(s?C(A(s)).link:null)||s||n||t||e}(e);try{return new In(t)}catch{return null}}}class bn{constructor(){this.providerId=bn.PROVIDER_ID}static credential(e,t){return _n._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=In.parseLink(t);return Ze(n,"argument-error"),_n._fromEmailAndCode(e,n.code,n.tenantId)}}bn.PROVIDER_ID="password",bn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",bn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Sn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Cn extends Sn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class An extends Cn{constructor(){super("facebook.com")}static credential(e){return Tn._fromParams({providerId:An.PROVIDER_ID,signInMethod:An.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return An.credentialFromTaggedObject(e)}static credentialFromError(e){return An.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return An.credential(e.oauthAccessToken)}catch{return null}}}An.FACEBOOK_SIGN_IN_METHOD="facebook.com",An.PROVIDER_ID="facebook.com";class kn extends Cn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Tn._fromParams({providerId:kn.PROVIDER_ID,signInMethod:kn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return kn.credentialFromTaggedObject(e)}static credentialFromError(e){return kn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return kn.credential(t,n)}catch{return null}}}kn.GOOGLE_SIGN_IN_METHOD="google.com",kn.PROVIDER_ID="google.com";class Nn extends Cn{constructor(){super("github.com")}static credential(e){return Tn._fromParams({providerId:Nn.PROVIDER_ID,signInMethod:Nn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nn.credentialFromTaggedObject(e)}static credentialFromError(e){return Nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Nn.credential(e.oauthAccessToken)}catch{return null}}}Nn.GITHUB_SIGN_IN_METHOD="github.com",Nn.PROVIDER_ID="github.com";class Rn extends Cn{constructor(){super("twitter.com")}static credential(e,t){return Tn._fromParams({providerId:Rn.PROVIDER_ID,signInMethod:Rn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Rn.credentialFromTaggedObject(e)}static credentialFromError(e){return Rn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Rn.credential(t,n)}catch{return null}}}async function Dn(e,t){return pt(e,"POST","/v1/accounts:signUp",lt(e,t))}Rn.TWITTER_SIGN_IN_METHOD="twitter.com",Rn.PROVIDER_ID="twitter.com";class On{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,s=!1){const r=await Lt._fromIdTokenResponse(e,n,s),i=Pn(n);return new On({user:r,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=Pn(n);return new On({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function Pn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Ln extends _{constructor(e,t,n,s){super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,Ln.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new Ln(e,t,n,s)}}function Mn(e,t,n,s){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Ln._fromErrorAndOperation(e,n,t,s);throw n})}async function xn(e,t,n=!1){if(Ce(e.app))return Promise.reject(Je(e));const s="signIn",r=await Mn(e,s,t),i=await On._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(i.user),i}async function Vn(e){const t=nn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Un(e,t,n){const s=nn(e),r={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};await dn(s,r,"getOobCode",wn)}async function Fn(e,t,n){if(Ce(e.app))return Promise.reject(Je(e));const s=nn(e),r=dn(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Dn),i=await r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Vn(e),t}),o=await On._fromIdTokenResponse(s,"signIn",i);return await s._updateCurrentUser(o.user),o}function jn(e,t,n){return Ce(e.app)?Promise.reject(Je(e)):async function(e,t){return xn(nn(e),t)}(R(e),bn.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Vn(e),t})}function Bn(e,t,n,s){return R(e).onAuthStateChanged(t,n,s)}function qn(e){return R(e).signOut()}const zn="__sak";class $n{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zn,"1"),this.storage.removeItem(zn),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Hn extends $n{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Jt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);Xt()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Hn.type="LOCAL";const Kn=Hn;class Gn extends $n{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Gn.type="SESSION";const Wn=Gn;class Qn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Qn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:r}=t.data,i=this.handlersMap[s];if(!i?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const o=Array.from(i).map(async e=>e(t.origin,r)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Xn(e="",t=10){let n="";for(let s=0;s<t;s++)n+=Math.floor(10*Math.random());return e+n}Qn.receivers=[];class Jn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,i;return new Promise((o,a)=>{const c=Xn("",20);s.port1.start();const h=setTimeout(()=>{a(new Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(h),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Yn(){return window}function Zn(){return void 0!==Yn().WorkerGlobalScope&&"function"==typeof Yn().importScripts}const es="firebaseLocalStorageDb",ts="firebaseLocalStorage",ns="fbase_key";class ss{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rs(e,t){return e.transaction([ts],t?"readwrite":"readonly").objectStore(ts)}function is(){const e=indexedDB.open(es,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ts,{keyPath:ns})}catch(s){n(s)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ts)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(es);return new ss(e).toPromise()}(),t(await is()))})})}async function os(e,t,n){const s=rs(e,!0).put({[ns]:t,value:n});return new ss(s).toPromise()}function as(e,t){const n=rs(e,!0).delete(t);return new ss(n).toPromise()}class cs{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await is()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Zn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qn._getInstance(Zn()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Jn(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await is();return await os(e,zn,"1"),await as(e,zn),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>os(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=rs(e,!1).get(t),s=await new ss(n).toPromise();return void 0===s?null:s.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>as(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=rs(e,!1).getAll();return new ss(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:s,value:r}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}cs.type="LOCAL";const hs=cs;function us(e,t){return t?xt(t):(Ze(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}new it(3e4,6e4);class ls extends gn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return En(e,this._buildIdpRequest())}_linkToIdToken(e,t){return En(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return En(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ds(e){return xn(e.auth,new ls(e),e.bypassAuthState)}function fs(e){const{auth:t,user:n}=e;return Ze(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if(Ce(s.app))return Promise.reject(Je(s));const r="reauthenticate";try{const i=await At(e,Mn(s,r,t,e),n);Ze(i.idToken,s,"internal-error");const o=St(i.idToken);Ze(o,s,"internal-error");const{sub:a}=o;return Ze(e.uid===a,s,"user-mismatch"),On._forOperation(e,r,i)}catch(i){throw"auth/user-not-found"===i?.code&&We(s,"user-mismatch"),i}}(n,new ls(e),e.bypassAuthState)}async function ps(e){const{auth:t,user:n}=e;return Ze(n,t,"internal-error"),async function(e,t,n=!1){const s=await At(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return On._forOperation(e,"link",s)}(n,new ls(e),e.bypassAuthState)}class ms{constructor(e,t,n,s,r=!1){this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:r,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ds;case"linkViaPopup":case"linkViaRedirect":return ps;case"reauthViaPopup":case"reauthViaRedirect":return fs;default:We(this.auth,"internal-error")}}resolve(e){tt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){tt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const gs=new it(2e3,1e4);async function ys(e,t,n){if(Ce(e.app))return Promise.reject(Qe(e,"operation-not-supported-in-this-environment"));const s=nn(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&We(e,"argument-error"),Xe(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,Sn);const r=us(s,n);return new vs(s,"signInViaPopup",t,r).executeNotNull()}class vs extends ms{constructor(e,t,n,s,r){super(e,t,s,r),this.provider=n,this.authWindow=null,this.pollId=null,vs.currentPopupAction&&vs.currentPopupAction.cancel(),vs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ze(e,this.auth,"internal-error"),e}async onExecution(){tt(1===this.filter.length,"Popup operations only handle one event");const e=Xn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Qe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vs.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qe(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,gs.get())};e()}}vs.currentPopupAction=null;const ws="pendingRedirect",_s=new Map;class Es extends ms{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=_s.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Ft(ws,e.config.apiKey,e.name)}(t),s=function(e){return xt(e._redirectPersistence)}(e);if(!(await s._isAvailable()))return!1;const r="true"===await s._get(n);return await s._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}_s.set(this.auth._key(),e)}return this.bypassAuthState||_s.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ts(e,t){_s.set(e._key(),t)}async function Is(e,t,n=!1){if(Ce(e.app))return Promise.reject(Je(e));const s=nn(e),r=us(s,t),i=new Es(s,r,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,t)),o}class bs{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Cs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Cs(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Qe(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ss(e))}saveEventToCache(e){this.cachedEventUids.add(Ss(e)),this.lastProcessedEventTime=Date.now()}}function Ss(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Cs({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}const As=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ks=/^https?/;async function Ns(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return dt(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(Rs(n))return}catch{}We(e,"unauthorized-domain")}function Rs(e){const t=nt(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===s?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===s}if(!ks.test(n))return!1;if(As.test(e))return s===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const Ds=new it(3e4,6e4);function Os(){const e=Yn().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Ps(e){return new Promise((t,n)=>{function s(){Os(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Os(),n(Qe(e,"network-request-failed"))},timeout:Ds.get()})}if(Yn().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!Yn().gapi?.load){const t=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return Yn()[t]=()=>{gapi.load?s():n(Qe(e,"network-request-failed"))},on(`${rn.gapiScript}?onload=${t}`).catch(e=>n(e))}s()}}).catch(e=>{throw Ls=null,e})}let Ls=null;const Ms=new it(5e3,15e3),xs={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Vs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Us(e){const t=e.config;Ze(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?ot(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:Ne},r=Vs.get(e.config.apiHost);r&&(s.eid=r);const i=e._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${S(s).slice(1)}`}async function Fs(e){const t=await function(e){return Ls=Ls||Ps(e),Ls}(e),n=Yn().gapi;return Ze(n,e,"internal-error"),t.open({where:document.body,url:Us(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xs,dontclear:!0},t=>new Promise(async(n,s)=>{await t.restyle({setHideOnLeave:!1});const r=Qe(e,"network-request-failed"),i=Yn().setTimeout(()=>{s(r)},Ms.get());function o(){Yn().clearTimeout(i),n(t)}t.ping(o).then(o,()=>{s(r)})}))}const js={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Bs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function qs(e,t,n,s=500,r=600){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const c={...js,width:s.toString(),height:r.toString(),top:i,left:o},h=v().toLowerCase();n&&(a=$t(h)?"_blank":n),qt(h)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=v()){return Qt(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}(t||"",a),new Bs(null);const l=window.open(t||"",a,u);Ze(l,e,"popup-blocked");try{l.focus()}catch(d){}return new Bs(l)}const zs="__/auth/handler",$s="emulator/auth/handler",Hs=encodeURIComponent("fac");async function Ks(e,t,n,s,r,i){Ze(e.config.authDomain,e,"auth-domain-config-required"),Ze(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:Ne,eventId:r};if(t instanceof Sn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof Cn){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const c=await e._getAppCheckToken(),h=c?`#${Hs}=${encodeURIComponent(c)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${zs}`;return ot(e,$s)}(e)}?${S(a).slice(1)}${h}`}const Gs="webStorageSupport";const Ws=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wn,this._completeRedirectFn=Is,this._overrideRedirectResult=Ts}async _openPopup(e,t,n,s){tt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");return qs(e,await Ks(e,t,n,nt(),s),Xn())}async _openRedirect(e,t,n,s){await this._originValidation(e);return function(e){Yn().location.href=e}(await Ks(e,t,n,nt(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(tt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Fs(e),n=new bs(e);return t.register("authEvent",t=>{Ze(t?.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gs,{type:Gs},n=>{const s=n?.[0]?.[Gs];void 0!==s&&t(!!s),We(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ns(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Jt()||zt()||Qt()}};var Qs="@firebase/auth",Xs="1.11.1";class Js{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ys=l("authIdTokenMaxAge")||300;let Zs=null;function er(e=De()){const t=Se(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Se(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(I(n.getOptions(),t??{}))return e;We(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Ws,persistence:[hs,Kn,Wn]}),s=l("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ys)return;const s=t?.token;Zs!==s&&(Zs=s,await fetch(r,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});!function(e,t,n){R(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,s){R(e).onIdTokenChanged(t,n,s)}(n,e=>t(e))}}var r;const i=h("auth");return i&&fn(n,`http://${i}`),n}var tr;rn={loadJS:e=>new Promise((t,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{const t=Qe("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},tr="Browser",be(new D("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;Ze(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:i,authDomain:o,clientPlatform:tr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Yt(tr)},c=new tn(n,s,r,a);return function(e,t){const n=t?.persistence||[],s=(Array.isArray(n)?n:[n]).map(xt);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),be(new D("auth-internal",e=>{const t=nn(e.getProvider("auth").getImmediate());return new Js(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Oe(Qs,Xs,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(tr)),Oe(Qs,Xs,"esm2020");var nr,sr,rr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const s=Array(16);if("string"==typeof t)for(var r=0;r<16;++r)s[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;r<16;++r)s[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];let i,o=e.g[3];i=t+(o^n&(r^o))+s[0]+3614090360&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[1]+3905402710&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[2]+606105819&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[3]+3250441966&4294967295,i=t+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[4]+4118548399&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[5]+1200080426&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[6]+2821735955&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[7]+4249261313&4294967295,i=t+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[8]+1770035416&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[9]+2336552879&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[10]+4294925233&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[11]+2304563134&4294967295,i=t+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[12]+1804603682&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[13]+4254626195&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[14]+2792965006&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[15]+1236535329&4294967295,i=t+(r^o&((n=r+(i<<22&4294967295|i>>>10))^r))+s[1]+4129170786&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[6]+3225465664&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[11]+643717713&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[0]+3921069994&4294967295,i=t+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[5]+3593408605&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[10]+38016083&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[15]+3634488961&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[4]+3889429448&4294967295,i=t+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[9]+568446438&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[14]+3275163606&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[3]+4107603335&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[8]+1163531501&4294967295,i=t+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[13]+2850285829&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[2]+4243563512&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[7]+1735328473&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[12]+2368359562&4294967295,i=t+((n=r+(i<<20&4294967295|i>>>12))^r^o)+s[5]+4294588738&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[8]+2272392833&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[11]+1839030562&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[14]+4259657740&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[1]+2763975236&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[4]+1272893353&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[7]+4139469664&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[10]+3200236656&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[13]+681279174&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[0]+3936430074&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[3]+3572445317&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[6]+76029189&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[9]+3654602809&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[12]+3873151461&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[15]+530742520&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[2]+3299628645&4294967295,i=t+(r^((n=r+(i<<23&4294967295|i>>>9))|~o))+s[0]+4096336452&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[7]+1126891415&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[14]+2878612391&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[5]+4237533241&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[12]+1700485571&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[3]+2399980690&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[10]+4293915773&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[1]+2240044497&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[8]+1873313359&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[15]+4264355552&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[6]+2734768916&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[13]+1309151649&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[4]+4149444226&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[11]+3174756917&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[2]+718787259&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+o&4294967295}function s(e,t){this.h=t;const n=[];let s=!0;for(let r=e.length-1;r>=0;r--){const i=0|e[r];s&&i==t||(n[r]=i,s=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const s=t-this.blockSize,r=this.C;let i=this.h,o=0;for(;o<t;){if(0==i)for(;o<=s;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(r[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,r),i=0;break}}else for(;o<t;)if(r[i++]=e[o++],i==this.blockSize){n(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let s=0;s<32;s+=8)e[t++]=this.g[n]>>>s&255;return e};var r={};function i(e){return-128<=e&&e<128?function(e,t){var n=r;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new s([0|e],e<0?-1:0)}):new s([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(e<0)return d(o(-e));const t=[];let n=1;for(let s=0;e>=n;s++)t[s]=e/n|0,n*=4294967296;return new s(t,0)}var a=i(0),c=i(1),h=i(16777216);function u(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function l(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let s=0;s<t;s++)n[s]=~e.g[s];return new s(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(a,a);if(l(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(l(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(e.g.length>30){if(l(e)||l(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,s=t;s.l(e)<=0;)n=y(n),s=y(s);var r=v(n,1),i=v(s,1);for(s=v(s,2),n=v(n,2);!u(s);){var h=i.add(s);h.l(e)<=0&&(r=r.add(n),i=h),s=v(s,1),n=v(n,1)}return t=f(e,r.j(t)),new m(r,t)}for(r=a;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),s=(s=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,s-48),h=(i=o(n)).j(t);l(h)||h.l(e)>0;)h=(i=o(n-=s)).j(t);u(i)&&(i=c),r=r.add(i),e=f(e,h)}return new m(r,e)}function y(e){const t=e.g.length+1,n=[];for(let s=0;s<t;s++)n[s]=e.i(s)<<1|e.i(s-1)>>>31;return new s(n,e.h)}function v(e,t){const n=t>>5;t%=32;const r=e.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(l(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const s=this.i(n);e+=(s>=0?s:4294967296+s)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(l(this))return"-"+d(this).toString(e);const t=o(Math.pow(e,6));var n=this;let s="";for(;;){const r=g(n,t).g;let i=(((n=f(n,r.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(u(n=r))return i+s;for(;i.length<6;)i="0"+i;s=i+s}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return l(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return l(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let r=0;for(let s=0;s<=t;s++){let t=r+(65535&this.i(s))+(65535&e.i(s)),i=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=i>>>16,t&=65535,i&=65535,n[s]=i<<16|t}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(l(this))return l(e)?d(this).j(d(e)):d(d(this).j(e));if(l(e))return d(this.j(d(e)));if(this.l(h)<0&&e.l(h)<0)return o(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){const s=this.i(r)>>>16,i=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=i*a,p(n,2*r+2*t),n[2*r+2*t+1]+=s*a,p(n,2*r+2*t+1),n[2*r+2*t+1]+=i*o,p(n,2*r+2*t+1),n[2*r+2*t+2]+=s*o,p(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new s(n,0)},e.B=function(e){return g(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;s<t;s++)n[s]=this.i(s)&e.i(s);return new s(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;s<t;s++)n[s]=this.i(s)|e.i(s);return new s(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;s<t;s++)n[s]=this.i(s)^e.i(s);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,sr=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=o,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const s=o(Math.pow(n,8));let r=a;for(let a=0;a<t.length;a+=8){var i=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+i),n);i<8?(i=o(Math.pow(n,i)),r=r.j(i).add(o(e))):(r=r.j(s),r=r.add(o(e)))}return r},nr=s}).apply(void 0!==rr?rr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ir,or,ar,cr,hr,ur,lr,dr,fr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof fr&&fr];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(e,s){if(s)e:{var r=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in r))break e;r=r[o]}(s=s(i=r[e=e[e.length-1]]))!=i&&null!=s&&t(r,e,{configurable:!0,writable:!0,value:s})}}s("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var r=r||{},i=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function h(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}var l="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function f(e,t){for(let s=1;s<arguments.length;s++){const t=arguments[s];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const s=t.length||0;e.length=n+s;for(let r=0;r<s;r++)e[n+r]=t[r]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function m(){var e=_;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,w=!1,_=new class{constructor(){this.h=this.g=null}add(e,t){const n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},E=()=>{const e=Promise.resolve(void 0);v=()=>{e.then(T)}};function T(){for(var e;e=m();){try{e.h.call(e.g)}catch(n){p(n)}var t=g;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}w=!1}function I(){this.u=this.u,this.C=this.C}function b(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},b.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function C(e){return/^[\s\xa0]*$/.test(e)}function A(e,t){b.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(A,b),A.prototype.init=function(e,t){const n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var k="closure_listenable_"+(1e6*Math.random()|0),N=0;function R(e,t,n,s,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.ha=r,this.key=++N,this.da=this.fa=!1}function D(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function O(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function P(e){const t={};for(const n in e)t[n]=e[n];return t}const L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(e,t){let n,s;for(let r=1;r<arguments.length;r++){for(n in s=arguments[r],s)e[n]=s[n];for(let t=0;t<L.length;t++)n=L[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function x(e){this.src=e,this.g={},this.h=0}function V(e,t){const n=t.type;if(n in e.g){var s,r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0);(s=i>=0)&&Array.prototype.splice.call(r,i,1),s&&(D(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function U(e,t,n,s){for(let r=0;r<e.length;++r){const i=e[r];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==s)return r}return-1}x.prototype.add=function(e,t,n,s,r){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const o=U(e,t,s,r);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new R(t,this.src,i,!!s,r)).fa=n,e.push(t)),t};var F="closure_lm_"+(1e6*Math.random()|0),j={};function B(e,t,n,s,r){if(Array.isArray(t)){for(let i=0;i<t.length;i++)B(e,t[i],n,s,r);return null}return n=W(n),e&&e[k]?e.J(t,n,!!o(s)&&!!s.capture,r):function(e,t,n,s,r,i){if(!t)throw Error("Invalid event type");const a=o(r)?!!r.capture:!!r;let c=K(e);if(c||(e[F]=c=new x(e)),n=c.add(t,n,s,a,i),n.proxy)return n;if(s=function(){function e(n){return t.call(e.src,e.listener,n)}const t=H;return e}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)S||(r=a),void 0===r&&(r=!1),e.addEventListener(t.toString(),s,r);else if(e.attachEvent)e.attachEvent($(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}(e,t,n,!1,s,r)}function q(e,t,n,s,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)q(e,t[i],n,s,r);else s=o(s)?!!s.capture:!!s,n=W(n),e&&e[k]?(e=e.i,(i=String(t).toString())in e.g&&((n=U(t=e.g[i],n,s,r))>-1&&(D(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--)))):e&&(e=K(e))&&(t=e.g[t.toString()],e=-1,t&&(e=U(t,n,s,r)),(n=e>-1?t[e]:null)&&z(n))}function z(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[k])V(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent($(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=K(t))?(V(n,e),0==n.h&&(n.src=null,t[F]=null)):D(e)}}}function $(e){return e in j?j[e]:j[e]="on"+e}function H(e,t){if(e.da)e=!0;else{t=new A(t,this);const n=e.listener,s=e.ha||e.src;e.fa&&z(e),e=n.call(s,t)}return e}function K(e){return(e=e[F])instanceof x?e:null}var G="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[G]||(e[G]=function(t){return e.handleEvent(t)}),e[G])}function Q(){I.call(this),this.i=new x(this),this.M=this,this.G=null}function X(e,t){var n,s=e.G;if(s)for(n=[];s;s=s.G)n.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new b(t,e);else if(t instanceof b)t.target=t.target||e;else{var r=t;M(t=new b(s,e),r)}let i,o;if(r=!0,n)for(o=n.length-1;o>=0;o--)i=t.g=n[o],r=J(i,s,!0,t)&&r;if(i=t.g=e,r=J(i,s,!0,t)&&r,r=J(i,s,!1,t)&&r,n)for(o=0;o<n.length;o++)i=t.g=n[o],r=J(i,s,!1,t)&&r}function J(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let r=!0;for(let i=0;i<t.length;++i){const o=t[i];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&V(e.i,o),r=!1!==t.call(n,s)&&r}}return r&&!s.defaultPrevented}function Y(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,Y(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(Q,I),Q.prototype[k]=!0,Q.prototype.removeEventListener=function(e,t,n,s){q(this,e,t,n,s)},Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)D(n[e]);delete e.g[t],e.h--}}this.G=null},Q.prototype.J=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},Q.prototype.K=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};class Z extends I{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:Y(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){I.call(this),this.h=e,this.g={}}u(ee,I);var te=[];function ne(e){O(e.g,function(e,t){this.g.hasOwnProperty(t)&&z(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),ne(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var se=i.JSON.stringify,re=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function oe(){}function ae(){}var ce={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function he(){b.call(this,"d")}function ue(){b.call(this,"c")}u(he,b),u(ue,b);var le={},de=null;function fe(){return de=de||new Q}function pe(e){b.call(this,le.Ia,e)}function me(e){const t=fe();X(t,new pe(t))}function ge(e,t){b.call(this,le.STAT_EVENT,e),this.stat=t}function ye(e){const t=fe();X(t,new ge(t,e))}function ve(e,t){b.call(this,le.Ja,e),this.size=t}function we(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function _e(){this.g=!0}function Ee(e,t,n,s){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(n.length<2)){var s=n[1];if(Array.isArray(s)&&!(s.length<1)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let e=1;e<s.length;e++)s[e]=""}}}return se(i)}catch(i){return t}}(e,n)+(s?" "+s:"")})}le.Ia="serverreachability",u(pe,b),le.STAT_EVENT="statevent",u(ge,b),le.Ja="timingevent",u(ve,b),_e.prototype.ua=function(){this.g=!1},_e.prototype.info=function(){};var Te,Ie={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},be={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Se(){}function Ce(e){return encodeURIComponent(String(e))}function Ae(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function ke(e,t,n,s){this.j=e,this.i=t,this.l=n,this.S=s||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ne}function Ne(){this.i=null,this.g="",this.h=!1}u(Se,oe),Se.prototype.g=function(){return new XMLHttpRequest},Te=new Se;var Re={},De={};function Oe(e,t,n){e.M=1,e.A=st(Ye(t)),e.u=n,e.R=!0,Pe(e,null)}function Pe(e,t){e.F=Date.now(),xe(e),e.B=Ye(e.A);var n=e.B,s=e.S;Array.isArray(s)||(s=[String(s)]),yt(n.i,"t",s),e.C=0,n=e.j.L,e.h=new Ne,e.g=sn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new Z(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,s=e.ba;var r="readystatechange";Array.isArray(r)||(r&&(te[0]=r.toString()),r=te);for(let i=0;i<r.length;i++){const e=B(n,r[i],s||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?P(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),me(),function(e,t,n,s,r,i){e.info(function(){if(e.g)if(i){var o="",a=i.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+c+"&":o+(e+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Le(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Me(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?De:(n=Number(t.substring(n,s)),isNaN(n)?Re:(s+=1)+n>t.length?De:(t=t.slice(s,s+n),e.C=s+n,t))}function xe(e){e.T=Date.now()+e.H,Ve(e,e.H)}function Ve(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=we(c(e.aa,e),t)}function Ue(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Fe(e){0==e.j.I||e.K||Yt(e.j,e)}function je(e){Ue(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ne(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Be(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Ke(n.h,e)))if(!e.L&&Ke(n.h,e)&&3==n.I){try{var s=n.Ba.g.parse(t)}catch(u){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;Jt(n),Bt(n)}Wt(n),ye(18)}}else n.xa=r[1],0<n.xa-n.K&&r[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=we(c(n.Va,n),6e3));He(n.h)<=1&&n.ta&&(n.ta=void 0)}else en(n,11)}else if((e.L||n.g==e)&&Jt(n),!C(t))for(r=n.Ba.g.parse(t),t=0;t<r.length;t++){let c=r[t];const u=c[0];if(!(u<=n.K))if(n.K=u,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const r=c[4];null!=r&&(n.za=r,n.j.info("SVER="+n.za));const u=c[5];null!=u&&"number"==typeof u&&u>0&&(s=1.5*u,n.O=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=s.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ge(i,i.h),i.h=null))}if(s.G){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.wa=e,nt(s.J,s.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((s=n).na=nn(s,s.L?s.ba:null,s.W),o.L){We(s.h,o);var a=o,h=s.O;h&&(a.H=h),a.D&&(Ue(a),xe(a)),s.g=o}else Gt(s);n.i.length>0&&zt(n)}else"stop"!=c[0]&&"close"!=c[0]||en(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?en(n,7):jt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}me()}catch(u){}}ke.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==xt(e)?t.j():this.Y(e)},ke.prototype.Y=function(e){try{if(e==this.g)e:{const c=xt(this.g),h=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Vt(this.g)))){this.K||4!=c||7==h||me(),Ue(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Le(e))return e.g.la();const t=Vt(e.g);if(""===t)return"";let n="";const s=t.length,r=4==xt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return je(e),Fe(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<s;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(r&&i==s-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,s,r,i,o){e.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var s,r=this.g;if((s=r.g?r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(s)){var o=s;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,ye(12),je(this),Fe(this);break e}Ee(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Be(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Me(this,n),t==De){4==c&&(this.m=4,ye(14),e=!1),Ee(this.i,this.l,null,"[Incomplete Response]");break}if(t==Re){this.m=4,ye(15),Ee(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Ee(this.i,this.l,t,null),Be(this,t)}if(Le(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,ye(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qt(a),a.P=!0,ye(11))}}else Ee(this.i,this.l,n,"[Invalid Chunked Response]"),je(this),Fe(this)}else Ee(this.i,this.l,n,null),Be(this,n);4==c&&je(this),this.o&&!this.K&&(4==c?Yt(this.j,this):(this.o=!1,xe(this)))}else(function(e){const t={};e=(e.g&&xt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(C(e[s]))continue;var n=Ae(e[s]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[r]||[];t[r]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,ye(12)):(this.m=0,ye(13)),je(this),Fe(this)}}}catch(c){}},ke.prototype.cancel=function(){this.K=!0,je(this)},ke.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(me(),ye(17)),je(this),this.m=2,Fe(this)):Ve(this,this.T-e)};var qe=class{constructor(e,t){this.g=e,this.map=t}};function ze(e){this.l=e||10,i.PerformanceNavigationTiming?e=(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $e(e){return!!e.h||!!e.g&&e.g.size>=e.j}function He(e){return e.h?1:e.g?e.g.size:0}function Ke(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ge(e,t){e.g?e.g.add(t):e.h=t}function We(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Qe(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}ze.prototype.cancel=function(){if(this.i=Qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Xe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Je(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Je?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,vt(e.i)),this.m=e.m):e&&(t=String(e).match(Xe))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=rt(t[2]||""),this.g=rt(t[3]||"",!0),et(this,t[4]),this.h=rt(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=rt(t[7]||"")):(this.l=!1,this.i=new dt(null,this.l))}function Ye(e){return new Je(e)}function Ze(e,t,n){e.j=n?rt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,n){t instanceof dt?(e.i=t,function(e,t){t&&!e.j&&(ft(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(pt(this,t),yt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=it(t,ut)),e.i=new dt(t,e.l))}function nt(e,t,n){e.i.set(t,n)}function st(e){return nt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function rt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ot),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ot(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Je.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,at,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,at,!0),"@"),e.push(Ce(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(it(n,"/"==n.charAt(0)?ht:ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",it(n,lt)),e.join("")},Je.prototype.resolve=function(e){const t=Ye(this);let n=!!e.j;n?Ze(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var s=e.h;if(n)et(t,e.u);else if(n=!!e.h){if("/"!=s.charAt(0))if(this.g&&!this.h)s="/"+s;else{var r=t.h.lastIndexOf("/");-1!=r&&(s=t.h.slice(0,r+1)+s)}if(".."==(r=s)||"."==r)s="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){s=0==r.lastIndexOf("/",0),r=r.split("/");const e=[];for(let t=0;t<r.length;){const n=r[t++];"."==n?s&&t==r.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),s&&t==r.length&&e.push("")):(e.push(n),s=!0)}s=e.join("/")}else s=r}return n?t.h=s:n=""!==e.i.toString(),n?tt(t,vt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var at=/[#\/\?@]/g,ct=/[#\?:]/g,ht=/[#\?]/g,ut=/[#\?@]/g,lt=/#/g;function dt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ft(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const s=e[n].indexOf("=");let r,i=null;s>=0?(r=e[n].substring(0,s),i=e[n].substring(s+1)):r=e[n],t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function pt(e,t){ft(e),t=wt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function mt(e,t){return ft(e),t=wt(e,t),e.g.has(t)}function gt(e,t){ft(e);let n=[];if("string"==typeof t)mt(e,t)&&(n=n.concat(e.g.get(wt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function yt(e,t,n){pt(e,t),n.length>0&&(e.i=null,e.g.set(wt(e,t),d(n)),e.h+=n.length)}function vt(e){const t=new dt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function wt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function _t(e,t,n,s,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),s(n)}catch(i){}}function Et(){this.g=new ie}function Tt(e){this.i=e.Sb||null,this.h=e.ab||!1}function It(e,t){Q.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function bt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function St(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Ct(e)}function Ct(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function At(e){let t="";return O(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function kt(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=At(n),"string"==typeof e?null!=n&&Ce(n):nt(e,t,n))}function Nt(e){Q.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=dt.prototype).add=function(e,t){ft(this),this.i=null,e=wt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){ft(this),this.g.forEach(function(n,s){n.forEach(function(n){e.call(t,n,s,this)},this)},this)},e.set=function(e,t){return ft(this),this.i=null,mt(this,e=wt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=gt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let s=0;s<t.length;s++){var n=t[s];const r=Ce(n);n=gt(this,n);for(let t=0;t<n.length;t++){let s=r;""!==n[t]&&(s+="="+Ce(n[t])),e.push(s)}}return this.i=e.join("&")},u(Tt,oe),Tt.prototype.g=function(){return new It(this.i,this.h)},u(It,Q),(e=It.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Ct(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,St(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ct(this)),this.g&&(this.readyState=3,Ct(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;bt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?St(this):Ct(this),3==this.readyState&&bt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,St(this))},e.Na=function(e){this.g&&(this.response=e,St(this))},e.ga=function(){this.g&&St(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(It.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Nt,Q);var Rt=/^https?$/i,Dt=["POST","PUT"];function Ot(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Pt(e),Mt(e)}function Pt(e){e.A||(e.A=!0,X(e,"complete"),X(e,"error"))}function Lt(e){if(e.h&&void 0!==r)if(e.v&&4==xt(e))setTimeout(e.Ca.bind(e),0);else if(X(e,"readystatechange"),4==xt(e)){e.h=!1;try{const r=e.ca();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){let t=String(e.D).match(Xe)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),s=!Rt.test(t?t.toLowerCase():"")}n=s}if(n)X(e,"complete"),X(e,"success");else{e.o=6;try{var o=xt(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Pt(e)}}finally{Mt(e)}}}function Mt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const s=e.g;e.g=null,t||X(e,"ready");try{s.onreadystatechange=null}catch(n){}}}function xt(e){return e.g?e.g.readyState:0}function Vt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ut(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ft(e){this.za=0,this.i=[],this.j=new _e,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ut("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ut("baseRetryDelayMs",5e3,e),this.Za=Ut("retryDelaySeedMs",1e4,e),this.Ta=Ut("forwardChannelMaxRetries",2,e),this.va=Ut("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new ze(e&&e.concurrentRequestLimit),this.Ba=new Et,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function jt(e){if(qt(e),3==e.I){var t=e.V++,n=Ye(e.J);if(nt(n,"SID",e.M),nt(n,"RID",t),nt(n,"TYPE","terminate"),Ht(e,n),(t=new ke(e,e.j,t)).M=2,t.A=st(Ye(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(s){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=sn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),xe(t)}tn(e)}function Bt(e){e.g&&(Qt(e),e.g.cancel(),e.g=null)}function qt(e){Bt(e),e.v&&(i.clearTimeout(e.v),e.v=null),Jt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function zt(e){if(!$e(e.h)&&!e.m){e.m=!0;var t=e.Ea;v||E(),w||(v(),w=!0),_.add(t,e),e.D=0}}function $t(e,t){var n;n=t?t.l:e.V++;const s=Ye(e.J);nt(s,"SID",e.M),nt(s,"RID",n),nt(s,"AID",e.K),Ht(e,s),e.u&&e.o&&kt(s,e.u,e.o),n=new ke(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Kt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ge(e.h,n),Oe(n,s,t)}function Ht(e,t){e.H&&O(e.H,function(e,n){nt(t,n,e)}),e.l&&O({},function(e,n){nt(t,n,e)})}function Kt(e,t,n){n=Math.min(e.i.length,n);const s=e.l?c(e.l.Ka,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let u=0;u<n;u++){var i=r[u].g;const n=r[u].map;if((i-=t)<0)t=Math.max(0,r[u].g-100),c=!1;else try{i="req"+i+"_"||"";try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let s=n;o(n)&&(s=se(n)),e.push(i+t+"="+encodeURIComponent(s))}}catch(h){throw e.push(i+"type="+encodeURIComponent("_badmap")),h}}catch(h){s&&s(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function Gt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;v||E(),w||(v(),w=!0),_.add(t,e),e.A=0}}function Wt(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=we(c(e.Da,e),Zt(e,e.A)),e.A++,!0)}function Qt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Xt(e){e.g=new ke(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Ye(e.na);nt(t,"RID","rpc"),nt(t,"SID",e.M),nt(t,"AID",e.K),nt(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&nt(t,"TO",e.ia),nt(t,"TYPE","xmlhttp"),Ht(e,t),e.u&&e.o&&kt(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=st(Ye(t)),n.u=null,n.R=!0,Pe(n,e)}function Jt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Yt(e,t){var n=null;if(e.g==t){Jt(e),Qt(e),e.g=null;var s=2}else{if(!Ke(e.h,t))return;n=t.G,We(e.h,t),s=1}if(0!=e.I)if(t.o)if(1==s){n=t.u?t.u.length:0,t=Date.now()-t.F;var r=e.D;X(s=fe(),new ve(s,n)),zt(e)}else Gt(e);else if(3==(r=t.m)||0==r&&t.X>0||!(1==s&&function(e,t){return!(He(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=we(c(e.Ea,e,t),Zt(e,e.D)),e.D++,0)))}(e,t)||2==s&&Wt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),r){case 1:en(e,5);break;case 4:en(e,10);break;case 3:en(e,6);break;default:en(e,2)}}function Zt(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function en(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),s=e.Ua;const t=!s;s=new Je(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(s,"https"),st(s),t?function(e,t){const n=new _e;if(i.Image){const s=new Image;s.onload=h(_t,n,"TestLoadImage: loaded",!0,t,s),s.onerror=h(_t,n,"TestLoadImage: error",!1,t,s),s.onabort=h(_t,n,"TestLoadImage: abort",!1,t,s),s.ontimeout=h(_t,n,"TestLoadImage: timeout",!1,t,s),i.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=e}else t(!1)}(s.toString(),n):function(e,t){new _e;const n=new AbortController,s=setTimeout(()=>{n.abort(),_t(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(s),e.ok?_t(0,0,!0,t):_t(0,0,!1,t)}).catch(()=>{clearTimeout(s),_t(0,0,!1,t)})}(s.toString(),n)}else ye(2);e.I=0,e.l&&e.l.pa(t),tn(e),qt(e)}function tn(e){if(e.I=0,e.ja=[],e.l){const t=Qe(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function nn(e,t,n){var s=n instanceof Je?Ye(n):new Je(n);if(""!=s.g)t&&(s.g=t+"."+s.g),et(s,s.u);else{var r=i.location;s=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;const e=new Je(null);s&&Ze(e,s),t&&(e.g=t),r&&et(e,r),n&&(e.h=n),s=e}return n=e.G,t=e.wa,n&&t&&nt(s,n,t),nt(s,"VER",e.ka),Ht(e,s),s}function sn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Nt(new Tt({ab:n})):new Nt(e.ma)).Fa(e.L),t}function rn(){}function on(){}function an(e,t){Q.call(this),this.g=new Ft(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!C(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new un(this)}function cn(e){he.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function hn(){ue.call(this),this.status=1}function un(e){this.g=e}(e=Nt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Te.g(),this.g.onreadystatechange=l(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ot(this,o)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(Dt,t,void 0)>=0)||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){Ot(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,X(this,"complete"),X(this,"abort"),Mt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mt(this,!0)),Nt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Lt(this):this.Xa())},e.Xa=function(){Lt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return xt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),re(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ft.prototype).ka=8,e.I=1,e.connect=function(e,t,n,s){ye(0),this.W=e,this.H=t||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.J=nn(this,null,this.W),zt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const r=new ke(this,this.j,e);let i=this.o;if(this.U&&(i?(i=P(i),M(i,this.U)):i=this.U),null!==this.u||this.R||(r.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if((t+=s)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Kt(this,r,t),nt(n=Ye(this.J),"RID",e),nt(n,"CVER",22),this.G&&nt(n,"X-HTTP-Session-Id",this.G),Ht(this,n),i&&(this.R?t="headers="+Ce(At(i))+"&"+t:this.u&&kt(n,this.u,i)),Ge(this.h,r),this.Ra&&nt(n,"TYPE","init"),this.S?(nt(n,"$req",t),nt(n,"SID","null"),r.U=!0,Oe(r,n,null)):Oe(r,n,t),this.I=2}}else 3==this.I&&(e?$t(this,e):0==this.i.length||$e(this.h)||$t(this))},e.Da=function(){if(this.v=null,Xt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=we(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ye(10),Bt(this),Xt(this))},e.Va=function(){null!=this.C&&(this.C=null,Bt(this),Wt(this),ye(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),ye(2)):(this.j.info("Failed to ping google.com"),ye(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=rn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},on.prototype.g=function(e,t){return new an(e,t)},u(an,Q),an.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},an.prototype.close=function(){jt(this.g)},an.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=se(e),e=n);t.i.push(new qe(t.Ya++,e)),3==t.I&&zt(t)},an.prototype.N=function(){this.g.l=null,delete this.j,jt(this.g),delete this.g,an.Z.N.call(this)},u(cn,he),u(hn,ue),u(un,rn),un.prototype.ra=function(){X(this.g,"a")},un.prototype.qa=function(e){X(this.g,new cn(e))},un.prototype.pa=function(e){X(this.g,new hn)},un.prototype.oa=function(){X(this.g,"b")},on.prototype.createWebChannel=on.prototype.g,an.prototype.send=an.prototype.o,an.prototype.open=an.prototype.m,an.prototype.close=an.prototype.close,dr=function(){return new on},lr=function(){return fe()},ur=le,hr={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ie.NO_ERROR=0,Ie.TIMEOUT=8,Ie.HTTP_ERROR=6,cr=Ie,be.COMPLETE="complete",ar=be,ae.EventType=ce,ce.OPEN="a",ce.CLOSE="b",ce.ERROR="c",ce.MESSAGE="d",Q.prototype.listen=Q.prototype.J,or=ae,Nt.prototype.listenOnce=Nt.prototype.K,Nt.prototype.getLastError=Nt.prototype.Ha,Nt.prototype.getLastErrorCode=Nt.prototype.ya,Nt.prototype.getStatus=Nt.prototype.ca,Nt.prototype.getResponseJson=Nt.prototype.La,Nt.prototype.getResponseText=Nt.prototype.la,Nt.prototype.send=Nt.prototype.ea,Nt.prototype.setWithCredentials=Nt.prototype.Fa,ir=Nt}).apply(void 0!==fr?fr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const pr="@firebase/firestore",mr="4.9.2";class gr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gr.UNAUTHENTICATED=new gr(null),gr.GOOGLE_CREDENTIALS=new gr("google-credentials-uid"),gr.FIRST_PARTY=new gr("first-party-uid"),gr.MOCK_USER=new gr("mock-user");let yr="12.3.0";const vr=new B("@firebase/firestore");function wr(){return vr.logLevel}function _r(e,...t){if(vr.logLevel<=M.DEBUG){const n=t.map(Ir);vr.debug(`Firestore (${yr}): ${e}`,...n)}}function Er(e,...t){if(vr.logLevel<=M.ERROR){const n=t.map(Ir);vr.error(`Firestore (${yr}): ${e}`,...n)}}function Tr(e,...t){if(vr.logLevel<=M.WARN){const n=t.map(Ir);vr.warn(`Firestore (${yr}): ${e}`,...n)}}function Ir(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function br(e,t,n){let s="Unexpected state";"string"==typeof t?s=t:n=t,Sr(e,s,n)}function Sr(e,t,n){let s=`FIRESTORE (${yr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{s+=" CONTEXT: "+JSON.stringify(n)}catch(r){s+=" CONTEXT: "+n}throw Er(s),new Error(s)}function Cr(e,t,n,s){let r="Unexpected state";"string"==typeof n?r=n:s=n,e||Sr(t,r,s)}function Ar(e,t){return e}const kr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Nr extends _{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Rr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Or{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gr.UNAUTHENTICATED))}shutdown(){}}class Pr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Lr{constructor(e){this.t=e,this.currentUser=gr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Cr(void 0===this.o,42304);let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new Rr;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Rr,e.enqueueRetryable(()=>s(this.currentUser))};const i=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await s(this.currentUser)})},o=e=>{_r("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(_r("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Rr)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(_r("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Cr("string"==typeof t.accessToken,31837,{l:t}),new Dr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Cr(null===e||"string"==typeof e,2055,{h:e}),new gr(e)}}class Mr{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=gr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class xr{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Mr(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(gr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Vr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ur{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ce(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Cr(void 0===this.o,3512);const n=e=>{null!=e.error&&_r("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,_r("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const s=e=>{_r("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>s(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?s(e):_r("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Vr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Cr("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Vr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Fr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let s=0;s<e;s++)n[s]=Math.floor(256*Math.random());return n}class jr{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Fr(40);for(let s=0;s<n.length;++s)t.length<20&&n[s]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return t}}function Br(e,t){return e<t?-1:e>t?1:0}function qr(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.charAt(s),r=t.charAt(s);if(n!==r)return Hr(n)===Hr(r)?Br(n,r):Hr(n)?1:-1}return Br(e.length,t.length)}const zr=55296,$r=57343;function Hr(e){const t=e.charCodeAt(0);return t>=zr&&t<=$r}function Kr(e,t,n){return e.length===t.length&&e.every((e,s)=>n(e,t[s]))}const Gr="__name__";class Wr{constructor(e,t,n){void 0===t?t=0:t>e.length&&br(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&br(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Wr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Wr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=Wr.compareSegments(e.get(s),t.get(s));if(0!==n)return n}return Br(e.length,t.length)}static compareSegments(e,t){const n=Wr.isNumericId(e),s=Wr.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?Wr.extractNumericId(e).compare(Wr.extractNumericId(t)):qr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return nr.fromString(e.substring(4,e.length-2))}}class Qr extends Wr{construct(e,t,n){return new Qr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Nr(kr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new Qr(t)}static emptyPath(){return new Qr([])}}const Xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Jr extends Wr{construct(e,t,n){return new Jr(e,t,n)}static isValidIdentifier(e){return Xr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Jr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Gr}static keyField(){return new Jr([Gr])}static fromServerFormat(e){const t=[];let n="",s=0;const r=()=>{if(0===n.length)throw new Nr(kr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new Nr(kr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Nr(kr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(i=!i,s++):"."!==t||i?(n+=t,s++):(r(),s++)}if(r(),i)throw new Nr(kr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Jr(t)}static emptyPath(){return new Jr([])}}class Yr{constructor(e){this.path=e}static fromPath(e){return new Yr(Qr.fromString(e))}static fromName(e){return new Yr(Qr.fromString(e).popFirst(5))}static empty(){return new Yr(Qr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Qr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Qr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Yr(new Qr(e.slice()))}}function Zr(e){if(!Yr.isDocumentKey(e))throw new Nr(kr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ei(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ti(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":br(12329,{type:typeof e})}function ni(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Nr(kr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ti(e);throw new Nr(kr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function si(e,t){const n={typeString:e};return t&&(n.value=t),n}function ri(e,t){if(!ei(e))throw new Nr(kr.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in t)if(t[s]){const r=t[s].typeString,i="value"in t[s]?{value:t[s].value}:void 0;if(!(s in e)){n=`JSON missing required field: '${s}'`;break}const o=e[s];if(r&&typeof o!==r){n=`JSON field '${s}' must be a ${r}.`;break}if(void 0!==i&&o!==i.value){n=`Expected '${s}' field to equal '${i.value}'`;break}}if(n)throw new Nr(kr.INVALID_ARGUMENT,n);return!0}const ii=-62135596800,oi=1e6;class ai{static now(){return ai.fromMillis(Date.now())}static fromDate(e){return ai.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*oi);return new ai(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Nr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Nr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ii)throw new Nr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Nr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oi}_compareTo(e){return this.seconds===e.seconds?Br(this.nanoseconds,e.nanoseconds):Br(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ai._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ri(e,ai._jsonSchema))return new ai(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ii;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ai._jsonSchemaVersion="firestore/timestamp/1.0",ai._jsonSchema={type:si("string",ai._jsonSchemaVersion),seconds:si("number"),nanoseconds:si("number")};class ci{static fromTimestamp(e){return new ci(e)}static min(){return new ci(new ai(0,0))}static max(){return new ci(new ai(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function hi(e){return new ui(e.readTime,e.key,-1)}class ui{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ui(ci.min(),Yr.empty(),-1)}static max(){return new ui(ci.max(),Yr.empty(),-1)}}function li(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Yr.comparator(e.documentKey,t.documentKey),0!==n?n:Br(e.largestBatchId,t.largestBatchId))}class di{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function fi(e){if(e.code!==kr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;_r("LocalStore","Unexpectedly lost primary lease")}class pi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&br(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new pi((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof pi?t:pi.resolve(t)}catch(t){return pi.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):pi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):pi.reject(t)}static resolve(e){return new pi((t,n)=>{t(e)})}static reject(e){return new pi((t,n)=>{n(e)})}static waitFor(e){return new pi((t,n)=>{let s=0,r=0,i=!1;e.forEach(e=>{++s,e.next(()=>{++r,i&&r===s&&t()},e=>n(e))}),i=!0,r===s&&t()})}static or(e){let t=pi.resolve(!1);for(const n of e)t=t.next(e=>e?pi.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,s)=>{n.push(t.call(this,e,s))}),this.waitFor(n)}static mapArray(e,t){return new pi((n,s)=>{const r=e.length,i=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===r&&n(i)},e=>s(e))}})}static doWhile(e,t){return new pi((n,s)=>{const r=()=>{!0===e()?t().next(()=>{r()},s):n()};r()})}}function mi(e){return"IndexedDbTransactionError"===e.name}class gi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}gi.ce=-1;function yi(e){return null==e}function vi(e){return 0===e&&1/e==-1/0}function wi(e,t){let n=t;const s=e.length;for(let r=0;r<s;r++){const t=e.charAt(r);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function _i(e){return e+""}function Ei(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ti(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ii(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class bi{constructor(e,t){this.comparator=e,this.root=t||Ci.EMPTY}insert(e,t){return new bi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ci.BLACK,null,null))}remove(e){return new bi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ci.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Si(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Si(this.root,e,this.comparator,!1)}getReverseIterator(){return new Si(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Si(this.root,e,this.comparator,!0)}}class Si{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ci{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=null!=n?n:Ci.RED,this.left=null!=s?s:Ci.EMPTY,this.right=null!=r?r:Ci.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new Ci(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===r?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ci.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Ci.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ci.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ci.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw br(43730,{key:this.key,value:this.value});if(this.right.isRed())throw br(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw br(27949);return e+(this.isRed()?0:1)}}Ci.EMPTY=null,Ci.RED=!0,Ci.BLACK=!1,Ci.EMPTY=new class{constructor(){this.size=0}get key(){throw br(57766)}get value(){throw br(16141)}get color(){throw br(16727)}get left(){throw br(29726)}get right(){throw br(36894)}copy(e,t,n,s,r){return this}insert(e,t,n){return new Ci(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ai{constructor(e){this.comparator=e,this.data=new bi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ki(this.data.getIterator())}getIteratorFrom(e){return new ki(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ai))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ai(this.comparator);return t.data=e,t}}class ki{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ni{constructor(e){this.fields=e,e.sort(Jr.comparator)}static empty(){return new Ni([])}unionWith(e){let t=new Ai(Jr.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ni(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Kr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ri extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Di{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ri("Invalid base64 string: "+t):t}}(e);return new Di(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Di(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Br(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Di.EMPTY_BYTE_STRING=new Di("");const Oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pi(e){if(Cr(!!e,39018),"string"==typeof e){let t=0;const n=Oi.exec(e);if(Cr(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Li(e.seconds),nanos:Li(e.nanos)}}function Li(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Mi(e){return"string"==typeof e?Di.fromBase64String(e):Di.fromUint8Array(e)}const xi="server_timestamp",Vi="__type__",Ui="__previous_value__",Fi="__local_write_time__";function ji(e){const t=(e?.mapValue?.fields||{})[Vi]?.stringValue;return t===xi}function Bi(e){const t=e.mapValue.fields[Ui];return ji(t)?Bi(t):t}function qi(e){const t=Pi(e.mapValue.fields[Fi].timestampValue);return new ai(t.seconds,t.nanos)}class zi{constructor(e,t,n,s,r,i,o,a,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=h}}const $i="(default)";class Hi{constructor(e,t){this.projectId=e,this.database=t||$i}static empty(){return new Hi("","")}get isDefaultDatabase(){return this.database===$i}isEqual(e){return e instanceof Hi&&e.projectId===this.projectId&&e.database===this.database}}const Ki="__type__",Gi="__max__",Wi={},Qi="__vector__",Xi="value";function Ji(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ji(e)?4:function(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Gi}(e)?9007199254740991:function(e){const t=(e?.mapValue?.fields||{})[Ki]?.stringValue;return t===Qi}(e)?10:11:br(28295,{value:e})}function Yi(e,t){if(e===t)return!0;const n=Ji(e);if(n!==Ji(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return qi(e).isEqual(qi(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Pi(e.timestampValue),s=Pi(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return s=t,Mi(e.bytesValue).isEqual(Mi(s.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Li(e.geoPointValue.latitude)===Li(t.geoPointValue.latitude)&&Li(e.geoPointValue.longitude)===Li(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Li(e.integerValue)===Li(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Li(e.doubleValue),s=Li(t.doubleValue);return n===s?vi(n)===vi(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return Kr(e.arrayValue.values||[],t.arrayValue.values||[],Yi);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Ei(n)!==Ei(s))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===s[r]||!Yi(n[r],s[r])))return!1;return!0}(e,t);default:return br(52216,{left:e})}var s}function Zi(e,t){return void 0!==(e.values||[]).find(e=>Yi(e,t))}function eo(e,t){if(e===t)return 0;const n=Ji(e),s=Ji(t);if(n!==s)return Br(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Br(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Li(e.integerValue||e.doubleValue),s=Li(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return to(e.timestampValue,t.timestampValue);case 4:return to(qi(e),qi(t));case 5:return qr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Mi(e),s=Mi(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let r=0;r<n.length&&r<s.length;r++){const e=Br(n[r],s[r]);if(0!==e)return e}return Br(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Br(Li(e.latitude),Li(t.latitude));return 0!==n?n:Br(Li(e.longitude),Li(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return no(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},s=t.fields||{},r=n[Xi]?.arrayValue,i=s[Xi]?.arrayValue,o=Br(r?.values?.length||0,i?.values?.length||0);return 0!==o?o:no(r,i)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Wi&&t===Wi)return 0;if(e===Wi)return 1;if(t===Wi)return-1;const n=e.fields||{},s=Object.keys(n),r=t.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let o=0;o<s.length&&o<i.length;++o){const e=qr(s[o],i[o]);if(0!==e)return e;const t=eo(n[s[o]],r[i[o]]);if(0!==t)return t}return Br(s.length,i.length)}(e.mapValue,t.mapValue);default:throw br(23264,{he:n})}}function to(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Br(e,t);const n=Pi(e),s=Pi(t),r=Br(n.seconds,s.seconds);return 0!==r?r:Br(n.nanos,s.nanos)}function no(e,t){const n=e.values||[],s=t.values||[];for(let r=0;r<n.length&&r<s.length;++r){const e=eo(n[r],s[r]);if(e)return e}return Br(n.length,s.length)}function so(e){return ro(e)}function ro(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Pi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Mi(e.bytesValue).toBase64():"referenceValue"in e?function(e){return Yr.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=ro(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const r of t)s?s=!1:n+=",",n+=`${r}:${ro(e.fields[r])}`;return n+"}"}(e.mapValue):br(61005,{value:e})}function io(e){switch(Ji(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Bi(e);return t?16+io(t):16;case 5:return 2*e.stringValue.length;case 6:return Mi(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+io(t),0);case 10:case 11:return function(e){let t=0;return Ti(e.fields,(e,n)=>{t+=e.length+io(n)}),t}(e.mapValue);default:throw br(13486,{value:e})}}function oo(e){return!!e&&"integerValue"in e}function ao(e){return!!e&&"arrayValue"in e}function co(e){return!!e&&"nullValue"in e}function ho(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function uo(e){return!!e&&"mapValue"in e}function lo(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return Ti(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=lo(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=lo(e.arrayValue.values[n]);return t}return{...e}}class fo{constructor(e){this.value=e}static empty(){return new fo({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!uo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=lo(t)}setAll(e){let t=Jr.emptyPath(),n={},s=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=r.popLast()}e?n[r.lastSegment()]=lo(e):s.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){const t=this.field(e.popLast());uo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Yi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];uo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Ti(t,(t,n)=>e[t]=n);for(const s of n)delete e[s]}clone(){return new fo(lo(this.value))}}function po(e){const t=[];return Ti(e.fields,(e,n)=>{const s=new Jr([e]);if(uo(n)){const e=po(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)}),new Ni(t)}class mo{constructor(e,t,n,s,r,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(e){return new mo(e,0,ci.min(),ci.min(),ci.min(),fo.empty(),0)}static newFoundDocument(e,t,n,s){return new mo(e,1,t,ci.min(),n,s,0)}static newNoDocument(e,t){return new mo(e,2,t,ci.min(),ci.min(),fo.empty(),0)}static newUnknownDocument(e,t){return new mo(e,3,t,ci.min(),ci.min(),fo.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ci.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fo.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ci.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof mo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new mo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class go{constructor(e,t){this.position=e,this.inclusive=t}}function yo(e,t,n){let s=0;for(let r=0;r<e.position.length;r++){const i=t[r],o=e.position[r];if(s=i.field.isKeyField()?Yr.comparator(Yr.fromName(o.referenceValue),n.key):eo(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function vo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Yi(e.position[n],t.position[n]))return!1;return!0}class wo{constructor(e,t="asc"){this.field=e,this.dir=t}}function _o(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Eo{}class To extends Eo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new No(e,t,n):"array-contains"===t?new Po(e,n):"in"===t?new Lo(e,n):"not-in"===t?new Mo(e,n):"array-contains-any"===t?new xo(e,n):new To(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ro(e,n):new Do(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(eo(t,this.value)):null!==t&&Ji(this.value)===Ji(t)&&this.matchesComparison(eo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return br(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Io extends Eo{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Io(e,t)}matches(e){return bo(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function bo(e){return"and"===e.op}function So(e){return function(e){for(const t of e.filters)if(t instanceof Io)return!1;return!0}(e)&&bo(e)}function Co(e){if(e instanceof To)return e.field.canonicalString()+e.op.toString()+so(e.value);if(So(e))return e.filters.map(e=>Co(e)).join(",");{const t=e.filters.map(e=>Co(e)).join(",");return`${e.op}(${t})`}}function Ao(e,t){return e instanceof To?(n=e,(s=t)instanceof To&&n.op===s.op&&n.field.isEqual(s.field)&&Yi(n.value,s.value)):e instanceof Io?function(e,t){return t instanceof Io&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,s)=>e&&Ao(n,t.filters[s]),!0)}(e,t):void br(19439);var n,s}function ko(e){return e instanceof To?`${(t=e).field.canonicalString()} ${t.op} ${so(t.value)}`:e instanceof Io?function(e){return e.op.toString()+" {"+e.getFilters().map(ko).join(" ,")+"}"}(e):"Filter";var t}class No extends To{constructor(e,t,n){super(e,t,n),this.key=Yr.fromName(n.referenceValue)}matches(e){const t=Yr.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ro extends To{constructor(e,t){super(e,"in",t),this.keys=Oo("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Do extends To{constructor(e,t){super(e,"not-in",t),this.keys=Oo("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Oo(e,t){return(t.arrayValue?.values||[]).map(e=>Yr.fromName(e.referenceValue))}class Po extends To{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ao(t)&&Zi(t.arrayValue,this.value)}}class Lo extends To{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Zi(this.value.arrayValue,t)}}class Mo extends To{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Zi(this.value.arrayValue,t)}}class xo extends To{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ao(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Zi(this.value.arrayValue,e))}}class Vo{constructor(e,t=null,n=[],s=[],r=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.Te=null}}function Uo(e,t=null,n=[],s=[],r=null,i=null,o=null){return new Vo(e,t,n,s,r,i,o)}function Fo(e){const t=Ar(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Co(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),yi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>so(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>so(e)).join(",")),t.Te=e}return t.Te}function jo(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!_o(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Ao(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!vo(e.startAt,t.startAt)&&vo(e.endAt,t.endAt)}function Bo(e){return Yr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class qo{constructor(e,t=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function zo(e){return new qo(e)}function $o(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Ho(e){const t=Ar(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Ai(Jr.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.Ie.push(new wo(s,n))}),e.has(Jr.keyField().canonicalString())||t.Ie.push(new wo(Jr.keyField(),n))}return t.Ie}function Ko(e){const t=Ar(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return Uo(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new wo(e.field,t)});const n=e.endAt?new go(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new go(e.startAt.position,e.startAt.inclusive):null;return Uo(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}(t,Ho(e))),t.Ee}function Go(e,t,n){return new qo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Wo(e,t){return jo(Ko(e),Ko(t))&&e.limitType===t.limitType}function Qo(e){return`${Fo(Ko(e))}|lt:${e.limitType}`}function Xo(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>ko(e)).join(", ")}]`),yi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>so(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>so(e)).join(",")),`Target(${t})`}(Ko(e))}; limitType=${e.limitType})`}function Jo(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Yr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ho(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(s=t,!((n=e).startAt&&!function(e,t,n){const s=yo(e,t,n);return e.inclusive?s<=0:s<0}(n.startAt,Ho(n),s)||n.endAt&&!function(e,t,n){const s=yo(e,t,n);return e.inclusive?s>=0:s>0}(n.endAt,Ho(n),s)));var n,s}function Yo(e){return(t,n)=>{let s=!1;for(const r of Ho(e)){const e=Zo(r,t,n);if(0!==e)return e;s=s||r.field.isKeyField()}return 0}}function Zo(e,t,n){const s=e.field.isKeyField()?Yr.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),r=n.data.field(e);return null!==s&&null!==r?eo(s,r):br(42886)}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return br(19790,{direction:e.dir})}}class ea{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,r]of n)if(this.equalsFn(s,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ti(this.inner,(t,n)=>{for(const[s,r]of n)e(s,r)})}isEmpty(){return Ii(this.inner)}size(){return this.innerSize}}const ta=new bi(Yr.comparator);function na(){return ta}const sa=new bi(Yr.comparator);function ra(...e){let t=sa;for(const n of e)t=t.insert(n.key,n);return t}function ia(e){let t=sa;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function oa(){return ca()}function aa(){return ca()}function ca(){return new ea(e=>e.toString(),(e,t)=>e.isEqual(t))}const ha=new bi(Yr.comparator),ua=new Ai(Yr.comparator);function la(...e){let t=ua;for(const n of e)t=t.add(n);return t}const da=new Ai(Br);function fa(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(t)?"-0":t}}function pa(e){return{integerValue:""+e}}function ma(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!vi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?pa(t):fa(e,t)}class ga{constructor(){this._=void 0}}function ya(e,t,n){return e instanceof _a?function(e,t){const n={fields:{[Vi]:{stringValue:xi},[Fi]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ji(t)&&(t=Bi(t)),t&&(n.fields[Ui]=t),{mapValue:n}}(n,t):e instanceof Ea?Ta(e,t):e instanceof Ia?ba(e,t):function(e,t){const n=wa(e,t),s=Ca(n)+Ca(e.Ae);return oo(n)&&oo(e.Ae)?pa(s):fa(e.serializer,s)}(e,t)}function va(e,t,n){return e instanceof Ea?Ta(e,t):e instanceof Ia?ba(e,t):n}function wa(e,t){return e instanceof Sa?oo(n=t)||(s=n)&&"doubleValue"in s?t:{integerValue:0}:null;var n,s}class _a extends ga{}class Ea extends ga{constructor(e){super(),this.elements=e}}function Ta(e,t){const n=Aa(t);for(const s of e.elements)n.some(e=>Yi(e,s))||n.push(s);return{arrayValue:{values:n}}}class Ia extends ga{constructor(e){super(),this.elements=e}}function ba(e,t){let n=Aa(t);for(const s of e.elements)n=n.filter(e=>!Yi(e,s));return{arrayValue:{values:n}}}class Sa extends ga{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ca(e){return Li(e.integerValue||e.doubleValue)}function Aa(e){return ao(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ka{constructor(e,t){this.version=e,this.transformResults=t}}class Na{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Na}static exists(e){return new Na(void 0,e)}static updateTime(e){return new Na(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ra(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Da{}function Oa(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new qa(e.key,Na.none()):new Va(e.key,e.data,Na.none());{const n=e.data,s=fo.empty();let r=new Ai(Jr.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),r=r.add(e)}return new Ua(e.key,s,new Ni(r.toArray()),Na.none())}}function Pa(e,t,n){var s;e instanceof Va?function(e,t,n){const s=e.value.clone(),r=ja(e.fieldTransforms,t,n.transformResults);s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Ua?function(e,t,n){if(!Ra(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=ja(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Fa(e)),r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):(s=n,t.convertToNoDocument(s.version).setHasCommittedMutations())}function La(e,t,n,s){return e instanceof Va?function(e,t,n,s){if(!Ra(e.precondition,t))return n;const r=e.value.clone(),i=Ba(e.fieldTransforms,s,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,s):e instanceof Ua?function(e,t,n,s){if(!Ra(e.precondition,t))return n;const r=Ba(e.fieldTransforms,s,t),i=t.data;return i.setAll(Fa(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,s):(r=t,i=n,Ra(e.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):i);var r,i}function Ma(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),r=wa(s.transform,e||null);null!=r&&(null===n&&(n=fo.empty()),n.set(s.field,r))}return n||null}function xa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,s=t.fieldTransforms,!!(void 0===n&&void 0===s||n&&s&&Kr(n,s,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,s=t.transform,n instanceof Ea&&s instanceof Ea||n instanceof Ia&&s instanceof Ia?Kr(n.elements,s.elements,Yi):n instanceof Sa&&s instanceof Sa?Yi(n.Ae,s.Ae):n instanceof _a&&s instanceof _a);var n,s}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,s}class Va extends Da{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ua extends Da{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Fa(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}}),t}function ja(e,t,n){const s=new Map;Cr(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let r=0;r<n.length;r++){const i=e[r],o=i.transform,a=t.data.field(i.field);s.set(i.field,va(o,a,n[r]))}return s}function Ba(e,t,n){const s=new Map;for(const r of e){const e=r.transform,i=n.data.field(r.field);s.set(r.field,ya(e,i,t))}return s}class qa extends Da{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class za extends Da{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $a{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const t=this.mutations[s];t.key.isEqual(e.key)&&Pa(t,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=La(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=La(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=aa();return this.mutations.forEach(s=>{const r=e.get(s.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=t.has(s.key)?null:o;const a=Oa(i,o);null!==a&&n.set(s.key,a),i.isValidDocument()||i.convertToNoDocument(ci.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),la())}isEqual(e){return this.batchId===e.batchId&&Kr(this.mutations,e.mutations,(e,t)=>xa(e,t))&&Kr(this.baseMutations,e.baseMutations,(e,t)=>xa(e,t))}}class Ha{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){Cr(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=function(){return ha}();const r=e.mutations;for(let i=0;i<r.length;i++)s=s.insert(r[i].key,n[i].version);return new Ha(e,t,n,s)}}class Ka{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ga{constructor(e,t){this.count=e,this.unchangedNames=t}}var Wa,Qa;function Xa(e){if(void 0===e)return Er("GRPC error has no .code"),kr.UNKNOWN;switch(e){case Wa.OK:return kr.OK;case Wa.CANCELLED:return kr.CANCELLED;case Wa.UNKNOWN:return kr.UNKNOWN;case Wa.DEADLINE_EXCEEDED:return kr.DEADLINE_EXCEEDED;case Wa.RESOURCE_EXHAUSTED:return kr.RESOURCE_EXHAUSTED;case Wa.INTERNAL:return kr.INTERNAL;case Wa.UNAVAILABLE:return kr.UNAVAILABLE;case Wa.UNAUTHENTICATED:return kr.UNAUTHENTICATED;case Wa.INVALID_ARGUMENT:return kr.INVALID_ARGUMENT;case Wa.NOT_FOUND:return kr.NOT_FOUND;case Wa.ALREADY_EXISTS:return kr.ALREADY_EXISTS;case Wa.PERMISSION_DENIED:return kr.PERMISSION_DENIED;case Wa.FAILED_PRECONDITION:return kr.FAILED_PRECONDITION;case Wa.ABORTED:return kr.ABORTED;case Wa.OUT_OF_RANGE:return kr.OUT_OF_RANGE;case Wa.UNIMPLEMENTED:return kr.UNIMPLEMENTED;case Wa.DATA_LOSS:return kr.DATA_LOSS;default:return br(39323,{code:e})}}(Qa=Wa||(Wa={}))[Qa.OK=0]="OK",Qa[Qa.CANCELLED=1]="CANCELLED",Qa[Qa.UNKNOWN=2]="UNKNOWN",Qa[Qa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qa[Qa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qa[Qa.NOT_FOUND=5]="NOT_FOUND",Qa[Qa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qa[Qa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qa[Qa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qa[Qa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qa[Qa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qa[Qa.ABORTED=10]="ABORTED",Qa[Qa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qa[Qa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qa[Qa.INTERNAL=13]="INTERNAL",Qa[Qa.UNAVAILABLE=14]="UNAVAILABLE",Qa[Qa.DATA_LOSS=15]="DATA_LOSS";const Ja=new nr([4294967295,4294967295],0);function Ya(e){const t=(new TextEncoder).encode(e),n=new sr;return n.update(t),new Uint8Array(n.digest())}function Za(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new nr([n,s],0),new nr([r,i],0)]}class ec{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new tc(`Invalid padding: ${t}`);if(n<0)throw new tc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new tc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new tc(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=nr.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(nr.fromNumber(n)));return 1===s.compare(Ja)&&(s=new nr([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Ya(e),[n,s]=Za(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,s,r);if(!this.we(e))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new ec(r,s,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=Ya(e),[n,s]=Za(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,s,r);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class tc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class nc{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,sc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new nc(ci.min(),s,new bi(Br),na(),la())}}class sc{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new sc(n,t,la(),la(),la())}}class rc{constructor(e,t,n,s){this.be=e,this.removedTargetIds=t,this.key=n,this.De=s}}class ic{constructor(e,t){this.targetId=e,this.Ce=t}}class oc{constructor(e,t,n=Di.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class ac{constructor(){this.ve=0,this.Fe=uc(),this.Me=Di.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=la(),t=la(),n=la();return this.Fe.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:br(38017,{changeType:r})}}),new sc(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=uc()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Cr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class cc{constructor(e){this.Ge=e,this.ze=new Map,this.je=na(),this.Je=hc(),this.He=hc(),this.Ye=new bi(Br)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:br(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,s=this.ot(t);if(s){const r=s.target;if(Bo(r))if(0===n){const e=new Yr(r.path);this.et(t,e,mo.newNoDocument(e,ci.min()))}else Cr(1===n,20013,{expectedCount:n});else{const s=this._t(t);if(s!==n){const n=this.ut(e),r=n?this.ct(n,e,s):1;if(0!==r){this.it(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t;let i,o;try{i=Mi(n).toUint8Array()}catch(a){if(a instanceof Ri)return Tr("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new ec(i,s,r)}catch(a){return Tr(a instanceof tc?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let s=0;return n.forEach(n=>{const r=this.Ge.ht(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.et(t,n,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((n,s)=>{const r=this.ot(s);if(r){if(n.current&&Bo(r.target)){const t=new Yr(r.target.path);this.It(t).has(s)||this.Et(s,t)||this.et(s,t,mo.newNoDocument(t,e))}n.Be&&(t.set(s,n.ke()),n.qe())}});let n=la();this.He.forEach((e,t)=>{let s=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)}),s&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const s=new nc(e,t,this.Ye,this.je,n);return this.je=na(),this.Je=hc(),this.He=hc(),this.Ye=new bi(Br),s}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ac,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ai(Br),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ai(Br),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||_r("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ac),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function hc(){return new bi(Yr.comparator)}function uc(){return new bi(Yr.comparator)}const lc=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),dc=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),fc=(()=>({and:"AND",or:"OR"}))();class pc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function mc(e,t){return e.useProto3Json||yi(t)?t:{value:t}}function gc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function yc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function vc(e,t){return gc(e,t.toTimestamp())}function wc(e){return Cr(!!e,49232),ci.fromTimestamp(function(e){const t=Pi(e);return new ai(t.seconds,t.nanos)}(e))}function _c(e,t){return Ec(e,t).canonicalString()}function Ec(e,t){const n=(s=e,new Qr(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===t?n:n.child(t)}function Tc(e){const t=Qr.fromString(e);return Cr(jc(t),10190,{key:t.toString()}),t}function Ic(e,t){return _c(e.databaseId,t.path)}function bc(e,t){const n=Tc(t);if(n.get(1)!==e.databaseId.projectId)throw new Nr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Nr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Yr(Ac(n))}function Sc(e,t){return _c(e.databaseId,t)}function Cc(e){return new Qr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ac(e){return Cr(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function kc(e,t,n){return{name:Ic(e,t),fields:n.value.mapValue.fields}}function Nc(e,t){return{documents:[Sc(e,t.path)]}}function Rc(e,t){const n={structuredQuery:{}},s=t.path;let r;null!==t.collectionGroup?(r=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=Sc(e,r);const i=function(e){if(0!==e.length)return Uc(Io.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>{return{field:xc((t=e).field),direction:Pc(t.dir)};var t})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=mc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:r};var c}function Dc(e){let t=function(e){const t=Tc(e);return 4===t.length?Qr.emptyPath():Ac(t)}(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){Cr(1===s,65062);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=Oc(e);return t instanceof Io&&So(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new wo(Vc((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,yi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new go(n,t)}(n.startAt));let h=null;return n.endAt&&(h=function(e){const t=!e.before,n=e.values||[];return new go(n,t)}(n.endAt)),function(e,t,n,s,r,i,o,a){return new qo(e,t,n,s,r,i,o,a)}(t,r,o,i,a,"F",c,h)}function Oc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Vc(e.unaryFilter.field);return To.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Vc(e.unaryFilter.field);return To.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Vc(e.unaryFilter.field);return To.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Vc(e.unaryFilter.field);return To.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return br(61313);default:return br(60726)}}(e):void 0!==e.fieldFilter?(t=e,To.create(Vc(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return br(58110);default:return br(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Io.create(e.compositeFilter.filters.map(e=>Oc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return br(1026)}}(e.compositeFilter.op))}(e):br(30097,{filter:e});var t}function Pc(e){return lc[e]}function Lc(e){return dc[e]}function Mc(e){return fc[e]}function xc(e){return{fieldPath:e.canonicalString()}}function Vc(e){return Jr.fromServerFormat(e.fieldPath)}function Uc(e){return e instanceof To?function(e){if("=="===e.op){if(ho(e.value))return{unaryFilter:{field:xc(e.field),op:"IS_NAN"}};if(co(e.value))return{unaryFilter:{field:xc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ho(e.value))return{unaryFilter:{field:xc(e.field),op:"IS_NOT_NAN"}};if(co(e.value))return{unaryFilter:{field:xc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xc(e.field),op:Lc(e.op),value:e.value}}}(e):e instanceof Io?function(e){const t=e.getFilters().map(e=>Uc(e));return 1===t.length?t[0]:{compositeFilter:{op:Mc(e.op),filters:t}}}(e):br(54877,{filter:e})}function Fc(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function jc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Bc{constructor(e,t,n,s,r=ci.min(),i=ci.min(),o=Di.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Bc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class qc{constructor(e){this.yt=e}}function zc(e){const t=Dc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Go(t,t.limit,"L"):t}class $c{constructor(){this.Cn=new Hc}addToCollectionParentIndex(e,t){return this.Cn.add(t),pi.resolve()}getCollectionParents(e,t){return pi.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return pi.resolve()}deleteFieldIndex(e,t){return pi.resolve()}deleteAllFieldIndexes(e){return pi.resolve()}createTargetIndexes(e,t){return pi.resolve()}getDocumentsMatchingTarget(e,t){return pi.resolve(null)}getIndexType(e,t){return pi.resolve(0)}getFieldIndexes(e,t){return pi.resolve([])}getNextCollectionGroupToUpdate(e){return pi.resolve(null)}getMinOffset(e,t){return pi.resolve(ui.min())}getMinOffsetFromCollectionGroup(e,t){return pi.resolve(ui.min())}updateCollectionGroup(e,t,n){return pi.resolve()}updateIndexEntries(e,t){return pi.resolve()}}class Hc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Ai(Qr.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Ai(Qr.comparator)).toArray()}}const Kc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gc=41943040;class Wc{static withCacheSize(e){return new Wc(e,Wc.DEFAULT_COLLECTION_PERCENTILE,Wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Wc.DEFAULT_COLLECTION_PERCENTILE=10,Wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Wc.DEFAULT=new Wc(Gc,Wc.DEFAULT_COLLECTION_PERCENTILE,Wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Wc.DISABLED=new Wc(-1,0,0);class Qc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Qc(0)}static cr(){return new Qc(-1)}}const Xc="LruGarbageCollector";function Jc([e,t],[n,s]){const r=Br(e,n);return 0===r?Br(t,s):r}class Yc{constructor(e){this.Ir=e,this.buffer=new Ai(Jc),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Jc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){_r(Xc,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){mi(e)?_r(Xc,"Ignoring IndexedDB error during garbage collection: ",e):await fi(e)}await this.Vr(3e5)})}}class eh{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return pi.resolve(gi.ce);const n=new Yc(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(_r("LruGarbageCollector","Garbage collection skipped; disabled"),pi.resolve(Kc)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(_r("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Kc):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,s,r,i,o,a,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(_r("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),s=this.params.maximumSequenceNumbersToCollect):s=t,i=Date.now(),this.nthSequenceNumber(e,s))).next(s=>(n=s,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),wr()<=M.DEBUG&&_r("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${s} in `+(o-i)+`ms\n\tRemoved ${r} targets in `+(a-o)+`ms\n\tRemoved ${e} documents in `+(c-a)+`ms\nTotal Duration: ${c-h}ms`),pi.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:e})))}}class th{constructor(){this.changes=new ea(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,mo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?pi.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class nh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sh{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&La(n.mutation,e,Ni.empty(),ai.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,la()).next(()=>t))}getLocalViewOfDocuments(e,t,n=la()){const s=oa();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(e=>{let t=ra();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=oa();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,la()))}populateOverlays(e,t,n){const s=[];return n.forEach(e=>{t.has(e)||s.push(e)}),this.documentOverlayCache.getOverlays(e,s).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,s){let r=na();const i=ca(),o=ca();return t.forEach((e,t)=>{const o=n.get(t.key);s.has(t.key)&&(void 0===o||o.mutation instanceof Ua)?r=r.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),La(o.mutation,t,o.mutation.getFieldMask(),ai.now())):i.set(t.key,Ni.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>o.set(e,new nh(t,i.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){const n=ca();let s=new bi((e,t)=>e-t),r=la();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Ni.empty();o=r.applyToLocalView(i,o),n.set(e,o);const a=(s.get(r.batchId)||la()).add(e);s=s.insert(r.batchId,a)})}).next(()=>{const i=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,h=aa();c.forEach(e=>{if(!r.has(e)){const s=Oa(t.get(e),n.get(e));null!==s&&h.set(e,s),r=r.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,h))}return pi.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,s){return r=t,Yr.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var r}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):pi.resolve(oa());let o=-1,a=r;return i.next(t=>pi.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?pi.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,la())).next(e=>({batchId:o,changes:ia(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Yr(t)).next(e=>{let t=ra();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const r=t.collectionGroup;let i=ra();return this.indexManager.getCollectionParents(e,r).next(o=>pi.forEach(o,o=>{const a=(c=t,h=o.child(r),new qo(h,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,h;return this.getDocumentsMatchingCollectionQuery(e,a,n,s).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(e=>{r.forEach((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,mo.newInvalidDocument(s)))});let n=ra();return e.forEach((e,s)=>{const i=r.get(e);void 0!==i&&La(i.mutation,s,Ni.empty(),ai.now()),Jo(t,s)&&(n=n.insert(e,s))}),n})}}class rh{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return pi.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(n=t).id,version:n.version,createTime:wc(n.createTime)}),pi.resolve();var n}getNamedQuery(e,t){return pi.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(n=t).name,query:zc(n.bundledQuery),readTime:wc(n.readTime)}),pi.resolve();var n}}class ih{constructor(){this.overlays=new bi(Yr.comparator),this.qr=new Map}getOverlay(e,t){return pi.resolve(this.overlays.get(t))}getOverlays(e,t){const n=oa();return pi.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,s)=>{this.St(e,t,s)}),pi.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.qr.get(n);return void 0!==s&&(s.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),pi.resolve()}getOverlaysForCollection(e,t,n){const s=oa(),r=t.length+1,i=new Yr(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>n&&s.set(e.getKey(),e)}return pi.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new bi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=oa(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=oa(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=s)););return pi.resolve(o)}St(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Ka(t,n));let r=this.qr.get(t);void 0===r&&(r=la(),this.qr.set(t,r)),this.qr.set(t,r.add(n.key))}}class oh{constructor(){this.sessionToken=Di.EMPTY_BYTE_STRING}getSessionToken(e){return pi.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,pi.resolve()}}class ah{constructor(){this.Qr=new Ai(ch.$r),this.Ur=new Ai(ch.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new ch(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new ch(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Yr(new Qr([])),n=new ch(t,e),s=new ch(t,e+1),r=[];return this.Ur.forEachInRange([n,s],e=>{this.Gr(e),r.push(e.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Yr(new Qr([])),n=new ch(t,e),s=new ch(t,e+1);let r=la();return this.Ur.forEachInRange([n,s],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new ch(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ch{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Yr.comparator(e.key,t.key)||Br(e.Yr,t.Yr)}static Kr(e,t){return Br(e.Yr,t.Yr)||Yr.comparator(e.key,t.key)}}class hh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ai(ch.$r)}checkEmpty(e){return pi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new $a(r,t,n,s);this.mutationQueue.push(i);for(const o of s)this.Zr=this.Zr.add(new ch(o.key,r)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return pi.resolve(i)}lookupMutationBatch(e,t){return pi.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.ei(n),r=s<0?0:s;return pi.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return pi.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return pi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ch(t,0),s=new ch(t,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,s],e=>{const t=this.Xr(e.Yr);r.push(t)}),pi.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ai(Br);return t.forEach(e=>{const t=new ch(e,0),s=new ch(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,s],e=>{n=n.add(e.Yr)})}),pi.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let r=n;Yr.isDocumentKey(r)||(r=r.child(""));const i=new ch(new Yr(r),0);let o=new Ai(Br);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(o=o.add(e.Yr)),!0)},i),pi.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Cr(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return pi.forEach(t.mutations,s=>{const r=new ch(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new ch(t,0),s=this.Zr.firstAfterOrEqual(n);return pi.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,pi.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class uh{constructor(e){this.ri=e,this.docs=new bi(Yr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),r=s?s.size:0,i=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return pi.resolve(n?n.document.mutableCopy():mo.newInvalidDocument(t))}getEntries(e,t){let n=na();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():mo.newInvalidDocument(e))}),pi.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=na();const i=t.path,o=new Yr(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||li(hi(o),n)<=0||(s.has(o.key)||Jo(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return pi.resolve(r)}getAllFromCollectionGroup(e,t,n,s){br(9500)}ii(e,t){return pi.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new lh(this)}getSize(e){return pi.resolve(this.size)}}class lh extends th{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(n)}),pi.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class dh{constructor(e){this.persistence=e,this.si=new ea(e=>Fo(e),jo),this.lastRemoteSnapshotVersion=ci.min(),this.highestTargetId=0,this.oi=0,this._i=new ah,this.targetCount=0,this.ai=Qc.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),pi.resolve()}getLastRemoteSnapshotVersion(e){return pi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return pi.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),pi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),pi.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Qc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,pi.resolve()}updateTargetData(e,t){return this.Pr(t),pi.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,pi.resolve()}removeTargets(e,t,n){let s=0;const r=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(i),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)}),pi.waitFor(r).next(()=>s)}getTargetCount(e){return pi.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return pi.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),pi.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(t=>{r.push(s.markPotentiallyOrphaned(e,t))}),pi.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),pi.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return pi.resolve(n)}containsKey(e,t){return pi.resolve(this._i.containsKey(t))}}class fh{constructor(e,t){this.ui={},this.overlays={},this.ci=new gi(0),this.li=!1,this.li=!0,this.hi=new oh,this.referenceDelegate=e(this),this.Pi=new dh(this),this.indexManager=new $c,this.remoteDocumentCache=new uh(e=>this.referenceDelegate.Ti(e)),this.serializer=new qc(t),this.Ii=new rh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ih,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new hh(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){_r("MemoryPersistence","Starting transaction:",e);const s=new ph(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(e=>this.referenceDelegate.di(s).next(()=>e)).toPromise().then(e=>(s.raiseOnCommittedEvent(),e))}Ai(e,t){return pi.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class ph extends di{constructor(e){super(),this.currentSequenceNumber=e}}class mh{constructor(e){this.persistence=e,this.Ri=new ah,this.Vi=null}static mi(e){return new mh(e)}get fi(){if(this.Vi)return this.Vi;throw br(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),pi.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),pi.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),pi.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pi.forEach(this.fi,n=>{const s=Yr.fromPath(n);return this.gi(e,s).next(e=>{e||t.removeEntry(s,ci.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return pi.or([()=>pi.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class gh{constructor(e,t){this.persistence=e,this.pi=new ea(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=_i(t)),t=wi(e.get(n),t);return _i(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new eh(e,t)}(this,t)}static mi(e,t){return new gh(e,t)}Ei(){}di(e){return pi.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return pi.forEach(this.pi,(n,s)=>this.br(e,n,s).next(e=>e?pi.resolve():t(s)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ii(e,s=>this.br(e,s,t).next(e=>{e||(n++,r.removeEntry(s,ci.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),pi.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),pi.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),pi.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),pi.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=io(e.data.value)),t}br(e,t,n){return pi.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return pi.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class yh{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=s}static As(e,t){let n=la(),s=la();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new yh(e,t.fromCache,n,s)}}class vh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class wh{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=w()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(v())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,s){const r={result:null};return this.ys(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.ws(e,t,s,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const n=new vh;return this.Ss(e,t,n).next(s=>{if(r.result=s,this.Vs)return this.bs(e,t,n,s.size)})}).next(()=>r.result)}bs(e,t,n,s){return n.documentReadCount<this.fs?(wr()<=M.DEBUG&&_r("QueryEngine","SDK will not create cache indexes for query:",Xo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),pi.resolve()):(wr()<=M.DEBUG&&_r("QueryEngine","Query:",Xo(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(wr()<=M.DEBUG&&_r("QueryEngine","The SDK decides to create cache indexes for query:",Xo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ko(t))):pi.resolve())}ys(e,t){if($o(t))return pi.resolve(null);let n=Ko(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=Go(t,null,"F"),n=Ko(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const r=la(...s);return this.ps.getDocuments(e,r).next(s=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.Ds(t,s);return this.Cs(t,i,r,n.readTime)?this.ys(e,Go(t,null,"F")):this.vs(e,i,t,n)}))})))}ws(e,t,n,s){return $o(t)||s.isEqual(ci.min())?pi.resolve(null):this.ps.getDocuments(e,n).next(r=>{const i=this.Ds(t,r);return this.Cs(t,i,n,s)?pi.resolve(null):(wr()<=M.DEBUG&&_r("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Xo(t)),this.vs(e,i,t,function(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,r=ci.fromTimestamp(1e9===s?new ai(n+1,0):new ai(n,s));return new ui(r,Yr.empty(),t)}(s,-1)).next(e=>e))})}Ds(e,t){let n=new Ai(Yo(e));return t.forEach((t,s)=>{Jo(e,s)&&(n=n.add(s))}),n}Cs(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ss(e,t,n){return wr()<=M.DEBUG&&_r("QueryEngine","Using full collection scan to execute query:",Xo(t)),this.ps.getDocumentsMatchingQuery(e,t,ui.min(),n)}vs(e,t,n,s){return this.ps.getDocumentsMatchingQuery(e,n,s).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const _h="LocalStore";class Eh{constructor(e,t,n,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new bi(Br),this.xs=new ea(e=>Fo(e),jo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sh(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function Th(e,t){const n=Ar(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next(r=>(s=r,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],i=[];let o=la();for(const e of s){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:r,addedBatchIds:i}))})})}function Ih(e){const t=Ar(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function bh(e,t){const n=Ar(e),s=t.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;const o=[];t.targetChanges.forEach((i,a)=>{const c=r.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,i.addedDocuments,a)));let h=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?h=h.withResumeToken(Di.EMPTY_BYTE_STRING,ci.min()).withLastLimboFreeSnapshotVersion(ci.min()):i.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(i.resumeToken,s)),r=r.insert(a,h),function(e,t,n){if(0===e.resumeToken.approximateByteSize())return!0;if(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,i)&&o.push(n.Pi.updateTargetData(e,h))});let a=na(),c=la();if(t.documentUpdates.forEach(s=>{t.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))}),o.push(function(e,t,n){let s=la(),r=la();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=na();return n.forEach((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(ci.min())?(t.removeEntry(n,i.readTime),s=s.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),s=s.insert(n,i)):_r(_h,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)}),{ks:s,qs:r}})}(e,i,t.documentUpdates).next(e=>{a=e.ks,c=e.qs})),!s.isEqual(ci.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,s));o.push(t)}return pi.waitFor(o).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.Ms=r,e))}function Sh(e,t){const n=Ar(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function Ch(e,t,n){const s=Ar(e),r=s.Ms.get(t),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,e=>s.persistence.referenceDelegate.removeTarget(e,r))}catch(o){if(!mi(o))throw o;_r(_h,`Failed to update sequence numbers for target ${t}: ${o}`)}s.Ms=s.Ms.remove(t),s.xs.delete(r.target)}function Ah(e,t,n){const s=Ar(e);let r=ci.min(),i=la();return s.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const s=Ar(e),r=s.xs.get(n);return void 0!==r?pi.resolve(s.Ms.get(r)):s.Pi.getTargetData(t,n)}(s,e,Ko(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>s.Fs.getDocumentsMatchingQuery(e,t,n?r:ci.min(),n?i:la())).next(e=>(function(e,t,n){let s=e.Os.get(t)||ci.min();n.forEach((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)}),e.Os.set(t,s)}(s,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class kh{constructor(){this.activeTargetIds=da}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Nh{constructor(){this.Mo=new kh,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new kh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Rh{Oo(e){}shutdown(){}}const Dh="ConnectivityMonitor";class Oh{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){_r(Dh,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){_r(Dh,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ph=null;function Lh(){return null===Ph?Ph=268435456+Math.round(2147483648*Math.random()):Ph++,"0x"+Ph.toString(16)}const Mh="RestConnection",xh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Vh{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===$i?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(e,t,n,s,r){const i=Lh(),o=this.zo(e,t.toUriEncodedString());_r(Mh,`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,s,r);const{host:c}=new URL(o),h=f(c);return this.Jo(e,o,a,n,h).then(t=>(_r(Mh,`Received RPC '${e}' ${i}: `,t),t),t=>{throw Tr(Mh,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,s,r,i){return this.Go(e,t,n,s,r)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+yr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=xh[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class Uh{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Fh="WebChannelConnection";class jh extends Vh{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,s,r){const i=Lh();return new Promise((r,o)=>{const a=new ir;a.setWithCredentials(!0),a.listenOnce(ar.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case cr.NO_ERROR:const t=a.getResponseJson();_r(Fh,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case cr.TIMEOUT:_r(Fh,`RPC '${e}' ${i} timed out`),o(new Nr(kr.DEADLINE_EXCEEDED,"Request time out"));break;case cr.HTTP_ERROR:const n=a.getStatus();if(_r(Fh,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(kr).indexOf(t)>=0?t:kr.UNKNOWN}(t.status);o(new Nr(e,t.message))}else o(new Nr(kr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Nr(kr.UNAVAILABLE,"Connection failed."));break;default:br(9055,{l_:e,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{_r(Fh,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);_r(Fh,`RPC '${e}' ${i} sending request:`,s),a.send(t,"POST",c,n,15)})}T_(e,t,n){const s=Lh(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=dr(),o=lr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const h=r.join("");_r(Fh,`Creating RPC '${e}' stream ${s}: ${h}`,a);const u=i.createWebChannel(h,a);this.I_(u);let l=!1,d=!1;const f=new Uh({Yo:t=>{d?_r(Fh,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(l||(_r(Fh,`Opening RPC '${e}' stream ${s} transport.`),u.open(),l=!0),_r(Fh,`RPC '${e}' stream ${s} sending:`,t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(u,or.EventType.OPEN,()=>{d||(_r(Fh,`RPC '${e}' stream ${s} transport opened.`),f.o_())}),p(u,or.EventType.CLOSE,()=>{d||(d=!0,_r(Fh,`RPC '${e}' stream ${s} transport closed`),f.a_(),this.E_(u))}),p(u,or.EventType.ERROR,t=>{d||(d=!0,Tr(Fh,`RPC '${e}' stream ${s} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new Nr(kr.UNAVAILABLE,"The operation could not be completed")))}),p(u,or.EventType.MESSAGE,t=>{if(!d){const n=t.data[0];Cr(!!n,16349);const r=n,i=r?.error||r[0]?.error;if(i){_r(Fh,`RPC '${e}' stream ${s} received error:`,i);const t=i.status;let n=function(e){const t=Wa[e];if(void 0!==t)return Xa(t)}(t),r=i.message;void 0===n&&(n=kr.INTERNAL,r="Unknown error status: "+t+" with message "+i.message),d=!0,f.a_(new Nr(n,r)),u.close()}else _r(Fh,`RPC '${e}' stream ${s} received:`,n),f.u_(n)}}),p(o,ur.STAT_EVENT,t=>{t.stat===hr.PROXY?_r(Fh,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===hr.NOPROXY&&_r(Fh,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Bh(){return"undefined"!=typeof document?document:null}function qh(e){return new pc(e,!0)}class zh{constructor(e,t,n=1e3,s=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=s,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-n);s>0&&_r("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const $h="PersistentStream";class Hh{constructor(e,t,n,s,r,i,o,a){this.Mi=e,this.S_=n,this.b_=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new zh(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===kr.RESOURCE_EXHAUSTED?(Er(t.toString()),Er("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===kr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new Nr(kr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return _r($h,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(_r($h,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Kh extends Hh{constructor(e,t,n,s,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:br(39313,{state:s}),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(Cr(void 0===t||"string"==typeof t,58123),Di.fromBase64String(t||"")):(Cr(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Di.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(e){const t=void 0===e.code?kr.UNKNOWN:Xa(e.code);return new Nr(t,e.message||"")}(a);n=new oc(r,i,o,c||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const r=bc(e,s.document.name),i=wc(s.document.updateTime),o=s.document.createTime?wc(s.document.createTime):ci.min(),a=new fo({mapValue:{fields:s.document.fields}}),c=mo.newFoundDocument(r,i,o,a),h=s.targetIds||[],u=s.removedTargetIds||[];n=new rc(h,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const r=bc(e,s.document),i=s.readTime?wc(s.readTime):ci.min(),o=mo.newNoDocument(r,i),a=s.removedTargetIds||[];n=new rc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const r=bc(e,s.document),i=s.removedTargetIds||[];n=new rc([],i,r,null)}else{if(!("filter"in t))return br(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:r}=e,i=new Ga(s,r),o=e.targetId;n=new ic(o,i)}}var s;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ci.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ci.min():t.readTime?wc(t.readTime):ci.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Cc(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=Bo(s)?{documents:Nc(e,s)}:{query:Rc(e,s).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=yc(e,t.resumeToken);const s=mc(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(ci.min())>0){n.readTime=gc(e,t.snapshotVersion.toTimestamp());const s=mc(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return br(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Cc(this.serializer),t.removeTarget=e,this.q_(t)}}class Gh extends Hh{constructor(e,t,n,s,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Cr(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Cr(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){Cr(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(Cr(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?wc(e.updateTime):wc(t);return n.isEqual(ci.min())&&(n=wc(t)),new ka(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=wc(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Cc(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof Va)n={update:kc(e,t.key,t.value)};else if(t instanceof qa)n={delete:Ic(e,t.key)};else if(t instanceof Ua)n={update:kc(e,t.key,t.data),updateMask:Fc(t.fieldMask)};else{if(!(t instanceof za))return br(16599,{Vt:t.type});n={verify:Ic(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof _a)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ea)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ia)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Sa)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw br(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=(s=e,void 0!==(r=t.precondition).updateTime?{updateTime:vc(s,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:br(27497))),n;var s,r}(this.serializer,e))};this.q_(t)}}class Wh{}class Qh extends Wh{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Nr(kr.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Go(e,Ec(t,n),s,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===kr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Nr(kr.UNKNOWN,e.toString())})}Ho(e,t,n,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Ho(e,Ec(t,n),s,i,o,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===kr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Nr(kr.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Xh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Er(t),this.aa=!1):_r("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Jh="RemoteStore";class Yh{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{au(this)&&(_r(Jh,"Restarting streams for network reachability change."),await async function(e){const t=Ar(e);t.Ea.add(4),await eu(t),t.Ra.set("Unknown"),t.Ea.delete(4),await Zh(t)}(this))})}),this.Ra=new Xh(n,s)}}async function Zh(e){if(au(e))for(const t of e.da)await t(!0)}async function eu(e){for(const t of e.da)await t(!1)}function tu(e,t){const n=Ar(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),ou(n)?iu(n):Su(n).O_()&&su(n,t))}function nu(e,t){const n=Ar(e),s=Su(n);n.Ia.delete(t),s.O_()&&ru(n,t),0===n.Ia.size&&(s.O_()?s.L_():au(n)&&n.Ra.set("Unknown"))}function su(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ci.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Su(e).Y_(t)}function ru(e,t){e.Va.Ue(t),Su(e).Z_(t)}function iu(e){e.Va=new cc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Su(e).start(),e.Ra.ua()}function ou(e){return au(e)&&!Su(e).x_()&&e.Ia.size>0}function au(e){return 0===Ar(e).Ea.size}function cu(e){e.Va=void 0}async function hu(e){e.Ra.set("Online")}async function uu(e){e.Ia.forEach((t,n)=>{su(e,t)})}async function lu(e,t){cu(e),ou(e)?(e.Ra.ha(t),iu(e)):e.Ra.set("Unknown")}async function du(e,t,n){if(e.Ra.set("Online"),t instanceof oc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.Ia.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.Ia.delete(s),e.Va.removeTarget(s))}(e,t)}catch(s){_r(Jh,"Failed to remove targets %s: %s ",t.targetIds.join(","),s),await fu(e,s)}else if(t instanceof rc?e.Va.Ze(t):t instanceof ic?e.Va.st(t):e.Va.tt(t),!n.isEqual(ci.min()))try{const t=await Ih(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Ia.get(s);r&&e.Ia.set(s,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const s=e.Ia.get(t);if(!s)return;e.Ia.set(t,s.withResumeToken(Di.EMPTY_BYTE_STRING,s.snapshotVersion)),ru(e,t);const r=new Bc(s.target,t,n,s.sequenceNumber);su(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(r){_r(Jh,"Failed to raise snapshot:",r),await fu(e,r)}}async function fu(e,t,n){if(!mi(t))throw t;e.Ea.add(1),await eu(e),e.Ra.set("Offline"),n||(n=()=>Ih(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{_r(Jh,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await Zh(e)})}function pu(e,t){return t().catch(n=>fu(e,n,t))}async function mu(e){const t=Ar(e),n=Cu(t);let s=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;gu(t);)try{const e=await Sh(t.localStore,s);if(null===e){0===t.Ta.length&&n.L_();break}s=e.batchId,yu(t,e)}catch(r){await fu(t,r)}vu(t)&&wu(t)}function gu(e){return au(e)&&e.Ta.length<10}function yu(e,t){e.Ta.push(t);const n=Cu(e);n.O_()&&n.X_&&n.ea(t.mutations)}function vu(e){return au(e)&&!Cu(e).x_()&&e.Ta.length>0}function wu(e){Cu(e).start()}async function _u(e){Cu(e).ra()}async function Eu(e){const t=Cu(e);for(const n of e.Ta)t.ea(n.mutations)}async function Tu(e,t,n){const s=e.Ta.shift(),r=Ha.from(s,t,n);await pu(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await mu(e)}async function Iu(e,t){t&&Cu(e).X_&&await async function(e,t){if(function(e){switch(e){case kr.OK:return br(64938);case kr.CANCELLED:case kr.UNKNOWN:case kr.DEADLINE_EXCEEDED:case kr.RESOURCE_EXHAUSTED:case kr.INTERNAL:case kr.UNAVAILABLE:case kr.UNAUTHENTICATED:return!1;case kr.INVALID_ARGUMENT:case kr.NOT_FOUND:case kr.ALREADY_EXISTS:case kr.PERMISSION_DENIED:case kr.FAILED_PRECONDITION:case kr.ABORTED:case kr.OUT_OF_RANGE:case kr.UNIMPLEMENTED:case kr.DATA_LOSS:return!0;default:return br(15467,{code:e})}}(n=t.code)&&n!==kr.ABORTED){const n=e.Ta.shift();Cu(e).B_(),await pu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await mu(e)}var n}(e,t),vu(e)&&wu(e)}async function bu(e,t){const n=Ar(e);n.asyncQueue.verifyOperationInProgress(),_r(Jh,"RemoteStore received new credentials");const s=au(n);n.Ea.add(3),await eu(n),s&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await Zh(n)}function Su(e){return e.ma||(e.ma=function(e,t,n){const s=Ar(e);return s.sa(),new Kh(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Xo:hu.bind(null,e),t_:uu.bind(null,e),r_:lu.bind(null,e),H_:du.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),ou(e)?iu(e):e.Ra.set("Unknown")):(await e.ma.stop(),cu(e))})),e.ma}function Cu(e){return e.fa||(e.fa=function(e,t,n){const s=Ar(e);return s.sa(),new Gh(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:_u.bind(null,e),r_:Iu.bind(null,e),ta:Eu.bind(null,e),na:Tu.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await mu(e)):(await e.fa.stop(),e.Ta.length>0&&(_r(Jh,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class Au{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new Rr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){const i=Date.now()+n,o=new Au(e,t,i,s,r);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Nr(kr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ku(e,t){if(Er("AsyncQueue",`${t}: ${e}`),mi(e))return new Nr(kr.UNAVAILABLE,`${t}: ${e}`);throw e}class Nu{static emptySet(e){return new Nu(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Yr.comparator(t.key,n.key):(e,t)=>Yr.comparator(e.key,t.key),this.keyedMap=ra(),this.sortedSet=new bi(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Nu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Nu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ru{constructor(){this.ga=new bi(Yr.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):br(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Du{constructor(e,t,n,s,r,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Du(e,t,Nu.emptySet(t),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class Ou{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Pu{constructor(){this.queries=Lu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=Ar(e),s=n.queries;n.queries=Lu(),s.forEach((e,n)=>{for(const s of n.Sa)s.onError(t)})}(this,new Nr(kr.ABORTED,"Firestore shutting down"))}}function Lu(){return new ea(e=>Qo(e),Wo)}function Mu(e,t){const n=Ar(e);let s=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(r)&&(s=!0);t.wa=r}}s&&Vu(n)}function xu(e,t,n){const s=Ar(e),r=s.queries.get(t);if(r)for(const i of r.Sa)i.onError(n);s.queries.delete(t)}function Vu(e){e.Ca.forEach(e=>{e.next()})}var Uu,Fu;(Fu=Uu||(Uu={})).Ma="default",Fu.Cache="cache";class ju{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Du(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Du.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Uu.Cache}}class Bu{constructor(e){this.key=e}}class qu{constructor(e){this.key=e}}class zu{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=la(),this.mutatedKeys=la(),this.eu=Yo(e),this.tu=new Nu(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Ru,s=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((e,t)=>{const h=s.get(e),u=Jo(this.query,t)?t:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||c&&this.eu(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(i=i.add(u),r=d?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{tu:i,iu:n,Cs:o,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return br(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),s=s??!1;const o=t&&!s?this._u():[],a=0===this.Xa.size&&this.current&&!s?1:0,c=a!==this.Za;return this.Za=a,0!==i.length||c?{snapshot:new Du(this.query,e.tu,r,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ru,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=la(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new qu(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Bu(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=la();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Du.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const $u="SyncEngine";class Hu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ku{constructor(e){this.key=e,this.hu=!1}}class Gu{constructor(e,t,n,s,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new ea(e=>Qo(e),Wo),this.Iu=new Map,this.Eu=new Set,this.du=new bi(Yr.comparator),this.Au=new Map,this.Ru=new ah,this.Vu={},this.mu=new Map,this.fu=Qc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Wu(e,t,n=!0){const s=ml(e);let r;const i=s.Tu.get(t);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await Xu(s,t,n,!0),r}async function Qu(e,t){const n=ml(e);await Xu(n,t,!0,!1)}async function Xu(e,t,n,s){const r=await function(e,t){const n=Ar(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let s;return n.Pi.getTargetData(e,t).next(r=>r?(s=r,pi.resolve(s)):n.Pi.allocateTargetId(e).next(r=>(s=new Bc(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,s).next(()=>s))))}).then(e=>{const s=n.Ms.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,Ko(t)),i=r.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let a;return s&&(a=await async function(e,t,n,s,r){e.pu=(t,n,s)=>async function(e,t,n,s){let r=t.view.ru(n);r.Cs&&(r=await Ah(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,r)));const i=s&&s.targetChanges.get(t.targetId),o=s&&null!=s.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,i,o);return hl(e,t.targetId,a.au),a.snapshot}(e,t,n,s);const i=await Ah(e.localStore,t,!0),o=new zu(t,i.Qs),a=o.ru(i.documents),c=sc.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,r),h=o.applyChanges(a,e.isPrimaryClient,c);hl(e,n,h.au);const u=new Hu(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}(e,t,i,"current"===o,r.resumeToken)),e.isPrimaryClient&&n&&tu(e.remoteStore,r),a}async function Ju(e,t,n){const s=Ar(e),r=s.Tu.get(t),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(e=>!Wo(e,t))),void s.Tu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Ch(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),n&&nu(s.remoteStore,r.targetId),al(s,r.targetId)}).catch(fi)):(al(s,r.targetId),await Ch(s.localStore,r.targetId,!0))}async function Yu(e,t){const n=Ar(e),s=n.Tu.get(t),r=n.Iu.get(s.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),nu(n.remoteStore,s.targetId))}async function Zu(e,t,n){const s=function(e){const t=Ar(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=sl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=rl.bind(null,t),t}(e);try{const e=await function(e,t){const n=Ar(e),s=ai.now(),r=t.reduce((e,t)=>e.add(t.key),la());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=na(),c=la();return n.Ns.getEntries(e,r).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(r=>{i=r;const o=[];for(const e of t){const t=Ma(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new Ua(e.key,t,po(t.value.mapValue),Na.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,o,t)}).next(t=>{o=t;const s=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:o.batchId,changes:ia(i)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.Vu[e.currentUser.toKey()];s||(s=new bi(Br)),s=s.insert(t,n),e.Vu[e.currentUser.toKey()]=s}(s,e.batchId,n),await dl(s,e.changes),await mu(s.remoteStore)}catch(r){const e=ku(r,"Failed to persist write");n.reject(e)}}async function el(e,t){const n=Ar(e);try{const e=await bh(n.localStore,t);t.targetChanges.forEach((e,t)=>{const s=n.Au.get(t);s&&(Cr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?s.hu=!0:e.modifiedDocuments.size>0?Cr(s.hu,14607):e.removedDocuments.size>0&&(Cr(s.hu,42227),s.hu=!1))}),await dl(n,e,t)}catch(s){await fi(s)}}function tl(e,t,n){const s=Ar(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.Tu.forEach((n,s)=>{const r=s.view.va(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=Ar(e);n.onlineState=t;let s=!1;n.queries.forEach((e,n)=>{for(const r of n.Sa)r.va(t)&&(s=!0)}),s&&Vu(n)}(s.eventManager,t),e.length&&s.Pu.H_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function nl(e,t,n){const s=Ar(e);s.sharedClientState.updateQueryState(t,"rejected",n);const r=s.Au.get(t),i=r&&r.key;if(i){let e=new bi(Yr.comparator);e=e.insert(i,mo.newNoDocument(i,ci.min()));const n=la().add(i),r=new nc(ci.min(),new Map,new bi(Br),e,n);await el(s,r),s.du=s.du.remove(i),s.Au.delete(t),ll(s)}else await Ch(s.localStore,t,!1).then(()=>al(s,t,n)).catch(fi)}async function sl(e,t){const n=Ar(e),s=t.batch.batchId;try{const e=await function(e,t){const n=Ar(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const s=t.batch.keys(),r=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const r=n.batch,i=r.keys();let o=pi.resolve();return i.forEach(e=>{o=o.next(()=>s.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);Cr(null!==i,48541),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=la();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,s))})}(n.localStore,t);ol(n,s,null),il(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await dl(n,e)}catch(r){await fi(r)}}async function rl(e,t,n){const s=Ar(e);try{const e=await function(e,t){const n=Ar(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(Cr(null!==t,37113),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s)).next(()=>n.localDocuments.getDocuments(e,s))})}(s.localStore,t);ol(s,t,n),il(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await dl(s,e)}catch(r){await fi(r)}}function il(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function ol(e,t,n){const s=Ar(e);let r=s.Vu[s.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),s.Vu[s.currentUser.toKey()]=r}}function al(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Iu.get(t))e.Tu.delete(s),n&&e.Pu.yu(s,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||cl(e,t)})}function cl(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(nu(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),ll(e))}function hl(e,t,n){for(const s of n)s instanceof Bu?(e.Ru.addReference(s.key,t),ul(e,s)):s instanceof qu?(_r($u,"Document no longer in limbo: "+s.key),e.Ru.removeReference(s.key,t),e.Ru.containsKey(s.key)||cl(e,s.key)):br(19791,{wu:s})}function ul(e,t){const n=t.key,s=n.path.canonicalString();e.du.get(n)||e.Eu.has(s)||(_r($u,"New document in limbo: "+n),e.Eu.add(s),ll(e))}function ll(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new Yr(Qr.fromString(t)),s=e.fu.next();e.Au.set(s,new Ku(n)),e.du=e.du.insert(n,s),tu(e.remoteStore,new Bc(Ko(zo(n.path)),s,"TargetPurposeLimboResolution",gi.ce))}}async function dl(e,t,n){const s=Ar(e),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((e,a)=>{o.push(s.pu(a,t,n).then(e=>{if((e||n)&&s.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(a.targetId)?.current;s.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){r.push(e);const t=yh.As(a.targetId,e);i.push(t)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(e,t){const n=Ar(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>pi.forEach(t,t=>pi.forEach(t.Es,s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s)).next(()=>pi.forEach(t.ds,s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))}catch(s){if(!mi(s))throw s;_r(_h,"Failed to update sequence numbers: "+s)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ms.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ms=n.Ms.insert(e,r)}}}(s.localStore,i))}async function fl(e,t){const n=Ar(e);if(!n.currentUser.isEqual(t)){_r($u,"User change. New user:",t.toKey());const e=await Th(n.localStore,t);n.currentUser=t,r="'waitForPendingWrites' promise is rejected due to a user change.",(s=n).mu.forEach(e=>{e.forEach(e=>{e.reject(new Nr(kr.CANCELLED,r))})}),s.mu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await dl(n,e.Ls)}var s,r}function pl(e,t){const n=Ar(e),s=n.Au.get(t);if(s&&s.hu)return la().add(s.key);{let e=la();const s=n.Iu.get(t);if(!s)return e;for(const t of s){const s=n.Tu.get(t);e=e.unionWith(s.view.nu)}return e}}function ml(e){const t=Ar(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=el.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=pl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=nl.bind(null,t),t.Pu.H_=Mu.bind(null,t.eventManager),t.Pu.yu=xu.bind(null,t.eventManager),t}class gl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qh(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,s){return new Eh(e,t,n,s)}(this.persistence,new wh,e.initialUser,this.serializer)}Cu(e){return new fh(mh.mi,this.serializer)}Du(e){return new Nh}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gl.provider={build:()=>new gl};class yl extends gl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Cr(this.persistence.referenceDelegate instanceof gh,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Zc(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Wc.withCacheSize(this.cacheSizeBytes):Wc.DEFAULT;return new fh(e=>gh.mi(e,t),this.serializer)}}class vl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>tl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=fl.bind(null,this.syncEngine),await async function(e,t){const n=Ar(e);t?(n.Ea.delete(2),await Zh(n)):t||(n.Ea.add(2),await eu(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Pu}createDatastore(e){const t=qh(e.databaseInfo.databaseId),n=(s=e.databaseInfo,new jh(s));var s;return function(e,t,n,s){return new Qh(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,s=e.asyncQueue,r=e=>tl(this.syncEngine,e,0),i=Oh.v()?new Oh:new Rh,new Yh(t,n,s,r,i);var t,n,s,r,i}createSyncEngine(e,t){return function(e,t,n,s,r,i,o){const a=new Gu(e,t,n,s,r,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=Ar(e);_r(Jh,"RemoteStore shutting down."),t.Ea.add(5),await eu(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}vl.provider={build:()=>new vl};class wl{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Er("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const _l="FirestoreClient";class El{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=gr.UNAUTHENTICATED,this.clientId=jr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{_r(_l,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(_r(_l,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ku(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Tl(e,t){e.asyncQueue.verifyOperationInProgress(),_r(_l,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener(async e=>{s.isEqual(e)||(await Th(t.localStore,e),s=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Il(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){_r(_l,"Using user provided OfflineComponentProvider");try{await Tl(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!("FirebaseError"===(n=r).name?n.code===kr.FAILED_PRECONDITION||n.code===kr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;Tr("Error using user provided cache. Falling back to memory cache: "+r),await Tl(e,new gl)}}else _r(_l,"Using default OfflineComponentProvider"),await Tl(e,new yl(void 0));var n;return e._offlineComponents}(e);_r(_l,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>bu(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>bu(t.remoteStore,n)),e._onlineComponents=t}async function bl(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(_r(_l,"Using user provided OnlineComponentProvider"),await Il(e,e._uninitializedComponentsProvider._online)):(_r(_l,"Using default OnlineComponentProvider"),await Il(e,new vl))),e._onlineComponents}async function Sl(e){const t=await bl(e),n=t.eventManager;return n.onListen=Wu.bind(null,t.syncEngine),n.onUnlisten=Ju.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Qu.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Yu.bind(null,t.syncEngine),n}function Cl(e,t,n={}){const s=new Rr;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,r){const i=new wl({next:a=>{i.Nu(),t.enqueueAndForget(()=>async function(e,t){const n=Ar(e),s=t.query;let r=3;const i=n.queries.get(s);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=t.Da()?0:1:!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}(e,o));const c=a.docs.has(n);!c&&a.fromCache?r.reject(new Nr(kr.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&s&&"server"===s.source?r.reject(new Nr(kr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:e=>r.reject(e)}),o=new ju(zo(n.path),i,{includeMetadataChanges:!0,qa:!0});return async function(t,n){const s=Ar(t);let r=3;const i=n.query;let o=s.queries.get(i);o?!o.ba()&&n.Da()&&(r=2):(o=new Ou,r=n.Da()?0:1);try{switch(r){case 0:o.wa=await s.onListen(i,!0);break;case 1:o.wa=await s.onListen(i,!1);break;case 2:await s.onFirstRemoteStoreListen(i)}}catch(e){const s=ku(e,`Initialization of query '${Xo(n.query)}' failed`);return void n.onError(s)}s.queries.set(i,o),o.Sa.push(n),n.va(s.onlineState),o.wa&&n.Fa(o.wa)&&Vu(s)}(e,o)}(await Sl(e),e.asyncQueue,t,n,s)),s.promise}function Al(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const kl=new Map,Nl="firestore.googleapis.com",Rl=!0;class Dl{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new Nr(kr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Nl,this.ssl=Rl}else this.host=e.host,this.ssl=e.ssl??Rl;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Gc;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Nr(kr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new Nr(kr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Al(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Nr(kr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Nr(kr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Nr(kr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Ol{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Nr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Nr(kr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Or;switch(e.type){case"firstParty":return new xr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Nr(kr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=kl.get(e);t&&(_r("ComponentProvider","Removing Datastore"),kl.delete(e),t.terminate())}(this),Promise.resolve()}}function Pl(e,t,n,s={}){e=ni(e,Ol);const r=f(t),o=e._getSettings(),a={...o,emulatorOptions:e._getEmulatorOptions()},c=`${t}:${n}`;r&&(p(`https://${c}`),y("Firestore",!0)),o.host!==Nl&&o.host!==c&&Tr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:c,ssl:r,emulatorOptions:s};if(!I(h,a)&&(e._setSettings(h),s.mockUserToken)){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=gr.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(s.mockUserToken,e._app?.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new Nr(kr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new gr(r)}e._authCredentials=new Pr(new Dr(t,n))}}class Ll{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ll(this.firestore,e,this._query)}}class Ml{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ml(this.firestore,e,this._key)}toJSON(){return{type:Ml._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ri(t,Ml._jsonSchema))return new Ml(e,n||null,new Yr(Qr.fromString(t.referencePath)))}}Ml._jsonSchemaVersion="firestore/documentReference/1.0",Ml._jsonSchema={type:si("string",Ml._jsonSchemaVersion),referencePath:si("string")};class xl extends Ll{constructor(e,t,n){super(e,t,zo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ml(this.firestore,null,new Yr(e))}withConverter(e){return new xl(this.firestore,e,this._path)}}function Vl(e,t,...n){if(e=R(e),1===arguments.length&&(t=jr.newId()),function(e,t,n){if(!n)throw new Nr(kr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}("doc","path",t),e instanceof Ol){const s=Qr.fromString(t,...n);return Zr(s),new Ml(e,null,new Yr(s))}{if(!(e instanceof Ml||e instanceof xl))throw new Nr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Qr.fromString(t,...n));return Zr(s),new Ml(e.firestore,e instanceof xl?e.converter:null,new Yr(s))}}const Ul="AsyncQueue";class Fl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new zh(this,"async_queue_retry"),this._c=()=>{const e=Bh();e&&_r(Ul,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Bh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Bh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Rr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!mi(e))throw e;_r(Ul,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,Er("INTERNAL UNHANDLED ERROR: ",jl(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Au.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(s),s}uc(){this.nc&&br(47125,{Pc:jl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function jl(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Bl extends Ol{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Fl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Fl(e),this._firestoreClient=void 0,await e}}}function ql(e,t){const n="object"==typeof e?e:De(),s="string"==typeof e?e:$i,r=Se(n,"firestore").getImmediate({identifier:s});if(!r._initialized){const e=(e=>{const t=h(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]})("firestore");e&&Pl(r,...e)}return r}function zl(e){if(e._terminated)throw new Nr(kr.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){const t=e._freezeSettings(),n=(s=e._databaseId,r=e._app?.options.appId||"",i=e._persistenceKey,o=t,new zi(s,r,i,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,Al(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator));var s,r,i,o;e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new El(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class $l{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $l(Di.fromBase64String(e))}catch(t){throw new Nr(kr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $l(Di.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$l._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ri(e,$l._jsonSchema))return $l.fromBase64String(e.bytes)}}$l._jsonSchemaVersion="firestore/bytes/1.0",$l._jsonSchema={type:si("string",$l._jsonSchemaVersion),bytes:si("string")};class Hl{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Nr(kr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Kl{constructor(e){this._methodName=e}}class Gl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Nr(kr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Nr(kr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Br(this._lat,e._lat)||Br(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gl._jsonSchemaVersion}}static fromJSON(e){if(ri(e,Gl._jsonSchema))return new Gl(e.latitude,e.longitude)}}Gl._jsonSchemaVersion="firestore/geoPoint/1.0",Gl._jsonSchema={type:si("string",Gl._jsonSchemaVersion),latitude:si("number"),longitude:si("number")};class Wl{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Wl._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ri(e,Wl._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Wl(e.vectorValues);throw new Nr(kr.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Wl._jsonSchemaVersion="firestore/vectorValue/1.0",Wl._jsonSchema={type:si("string",Wl._jsonSchemaVersion),vectorValues:si("object")};const Ql=/^__.*__$/;class Xl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ua(e,this.data,this.fieldMask,t,this.fieldTransforms):new Va(e,this.data,t,this.fieldTransforms)}}function Jl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw br(40011,{Ac:e})}}class Yl{constructor(e,t,n,s,r,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Yl({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return hd(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Jl(this.Ac)&&Ql.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Zl{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||qh(e)}Cc(e,t,n,s=!1){return new Yl({Ac:e,methodName:t,Dc:n,path:Jr.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ed(e){const t=e._freezeSettings(),n=qh(e._databaseId);return new Zl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function td(e,t,n,s,r,i={}){const o=e.Cc(i.merge||i.mergeFields?2:0,t,n,r);id("Data must be an object, but it was:",o,s);const a=sd(s,o);let c,h;if(i.merge)c=new Ni(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const s of i.mergeFields){const r=od(t,s,n);if(!o.contains(r))throw new Nr(kr.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);ud(e,r)||e.push(r)}c=new Ni(e),h=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,h=o.fieldTransforms;return new Xl(new fo(a),c,h)}function nd(e,t){if(rd(e=R(e)))return id("Unsupported field value:",t,e),sd(e,t);if(e instanceof Kl)return function(e,t){if(!Jl(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const r of e){let e=nd(r,t.wc(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=R(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ma(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ai.fromDate(e);return{timestampValue:gc(t.serializer,n)}}if(e instanceof ai){const n=new ai(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:gc(t.serializer,n)}}if(e instanceof Gl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof $l)return{bytesValue:yc(t.serializer,e._byteString)};if(e instanceof Ml){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.Sc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:_c(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Wl)return n=e,s=t,{mapValue:{fields:{[Ki]:{stringValue:Qi},[Xi]:{arrayValue:{values:n.toArray().map(e=>{if("number"!=typeof e)throw s.Sc("VectorValues must only contain numeric values.");return fa(s.serializer,e)})}}}}};var n,s;throw t.Sc(`Unsupported field value: ${ti(e)}`)}(e,t)}function sd(e,t){const n={};return Ii(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ti(e,(e,s)=>{const r=nd(s,t.mc(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function rd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ai||e instanceof Gl||e instanceof $l||e instanceof Ml||e instanceof Kl||e instanceof Wl)}function id(e,t,n){if(!rd(n)||!ei(n)){const s=ti(n);throw"an object"===s?t.Sc(e+" a custom object"):t.Sc(e+" "+s)}}function od(e,t,n){if((t=R(t))instanceof Hl)return t._internalPath;if("string"==typeof t)return cd(e,t);throw hd("Field path arguments must be of type string or ",e,!1,void 0,n)}const ad=new RegExp("[~\\*/\\[\\]]");function cd(e,t,n){if(t.search(ad)>=0)throw hd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Hl(...t.split("."))._internalPath}catch(s){throw hd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function hd(e,t,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${s}`),o&&(c+=` in document ${r}`),c+=")"),new Nr(kr.INVALID_ARGUMENT,a+e+c)}function ud(e,t){return e.some(e=>e.isEqual(t))}class ld{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Ml(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new dd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(fd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class dd extends ld{data(){return super.data()}}function fd(e,t){return"string"==typeof t?cd(e,t):t instanceof Hl?t._internalPath:t._delegate._internalPath}class pd{convertValue(e,t="none"){switch(Ji(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Li(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Mi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw br(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ti(e,(e,s)=>{n[e]=this.convertValue(s,t)}),n}convertVectorValue(e){const t=e.fields?.[Xi].arrayValue?.values?.map(e=>Li(e.doubleValue));return new Wl(t)}convertGeoPoint(e){return new Gl(Li(e.latitude),Li(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Bi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(qi(e));default:return null}}convertTimestamp(e){const t=Pi(e);return new ai(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Qr.fromString(e);Cr(jc(n),9688,{name:e});const s=new Hi(n.get(1),n.get(3)),r=new Yr(n.popFirst(5));return s.isEqual(t)||Er(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class md{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gd extends ld{constructor(e,t,n,s,r,i){super(e,t,n,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new yd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(fd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Nr(kr.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=gd._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}gd._jsonSchemaVersion="firestore/documentSnapshot/1.0",gd._jsonSchema={type:si("string",gd._jsonSchemaVersion),bundleSource:si("string","DocumentSnapshot"),bundleName:si("string"),bundle:si("string")};class yd extends gd{data(e={}){return super.data(e)}}class vd{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new md(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new yd(this._firestore,this._userDataWriter,n.key,n,new md(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Nr(kr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const s=new yd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new md(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const s=new yd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new md(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:wd(t.type),doc:s,oldIndex:r,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Nr(kr.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=vd._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=jr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],s=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),s.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function wd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return br(61501,{type:e})}}function _d(e){e=ni(e,Ml);const t=ni(e.firestore,Bl);return Cl(zl(t),e._key).then(n=>function(e,t,n){const s=n.docs.get(t._key),r=new Ed(e);return new gd(e,r,t._key,s,new md(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n))}vd._jsonSchemaVersion="firestore/querySnapshot/1.0",vd._jsonSchema={type:si("string",vd._jsonSchemaVersion),bundleSource:si("string","QuerySnapshot"),bundleName:si("string"),bundle:si("string")};class Ed extends pd{constructor(e){super(),this.firestore=e}convertBytes(e){return new $l(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ml(this.firestore,null,t)}}function Td(e,t,n){e=ni(e,Ml);const s=ni(e.firestore,Bl),r=function(e,t){let n;return n=e?e.toFirestore(t):t,n}(e.converter,t);return function(e,t){return function(e,t){const n=new Rr;return e.asyncQueue.enqueueAndForget(async()=>Zu(await function(e){return bl(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(zl(e),t)}(s,[td(ed(s),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Na.none())])}!function(e,t=!0){yr=Ne,be(new D("firestore",(e,{instanceIdentifier:n,options:s})=>{const r=e.getProvider("app").getImmediate(),i=new Bl(new Lr(e.getProvider("auth-internal")),new Ur(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Nr(kr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hi(e.options.projectId,t)}(r,n),r);return s={useFetchStreams:t,...s},i._setSettings(s),i},"PUBLIC").setMultipleInstances(!0)),Oe(pr,mr,e),Oe(pr,mr,"esm2020")}();export{kn as G,ql as a,It as b,qn as c,Vl as d,_d as e,Fn as f,er as g,jn as h,Re as i,Un as j,Td as k,Bn as o,ys as s};
